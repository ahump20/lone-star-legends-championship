<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Lone Star Legends - Championship Baseball</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #98D982 40%, #8B7355 100%);
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        #root {
            width: 100%;
            height: 100%;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Field Styles */
        .field {
            position: absolute;
            width: 800px;
            height: 800px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .infield {
            position: absolute;
            width: 400px;
            height: 400px;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            background: radial-gradient(ellipse at center, #8B7355 0%, #7A6248 100%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        .outfield {
            position: absolute;
            width: 800px;
            height: 600px;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(ellipse at bottom, #7CB342 0%, #689F38 100%);
            border-radius: 50% 50% 0 0;
            z-index: -1;
        }

        .warning-track {
            position: absolute;
            width: 900px;
            height: 650px;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: transparent;
            border: 20px solid #8B7355;
            border-radius: 50% 50% 0 0;
            border-bottom: none;
            z-index: -2;
        }

        /* Base Styles */
        .base {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFFFFF 0%, #F0F0F0 100%);
            border: 2px solid #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 10;
            transition: all 0.3s;
        }

        .base.occupied {
            background: linear-gradient(135deg, #4CAF50 0%, #45A049 100%);
            animation: basePulse 1s infinite;
        }

        @keyframes basePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .base-first { bottom: 250px; right: 150px; }
        .base-second { bottom: 400px; left: 50%; transform: translateX(-50%); }
        .base-third { bottom: 250px; left: 150px; }
        .base-home {
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
        }

        .pitchers-mound {
            position: absolute;
            width: 80px;
            height: 80px;
            bottom: 280px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle, #8B7355 0%, #6B5245 100%);
            border-radius: 50%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            z-index: 11;
        }

        /* Player Styles */
        .player {
            position: absolute;
            width: 50px;
            height: 50px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
        }

        .player-body {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .player.running {
            animation: playerRun 0.5s infinite;
        }

        @keyframes playerRun {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-5deg); }
            75% { transform: translateY(-5px) rotate(5deg); }
        }

        /* Ball */
        .ball {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF, #F0F0F0);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 30;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ball.flying {
            animation: ballFly 1s ease-out;
        }

        @keyframes ballFly {
            0% { transform: scale(1); }
            50% { transform: scale(0.6); }
            100% { transform: scale(1.2); }
        }

        /* HUD Styles */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.5) 100%);
            color: white;
            z-index: 100;
        }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .team-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .team-name {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .score {
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .inning-display {
            text-align: center;
        }

        .inning-number {
            font-size: 24px;
            font-weight: bold;
        }

        .inning-half {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Game Status */
        .game-status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 90;
        }

        .status-row {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .status-label {
            width: 60px;
            font-size: 12px;
            opacity: 0.8;
        }

        .status-dots {
            display: flex;
            gap: 5px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }

        .status-dot.active {
            background: #4CAF50;
            box-shadow: 0 0 5px #4CAF50;
        }

        .status-dot.ball { background: #2196F3; }
        .status-dot.strike { background: #F44336; }
        .status-dot.out { background: #FFD700; }

        /* Player Card */
        .player-card {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            backdrop-filter: blur(10px);
            z-index: 90;
            transform: translateY(150%);
            transition: transform 0.3s;
        }

        .player-card.active {
            transform: translateY(0);
        }

        .player-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
        }

        .stat-label {
            opacity: 0.7;
        }

        .stat-value {
            font-weight: bold;
        }

        /* Controls */
        .controls {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 95;
        }

        .control-btn {
            padding: 15px 30px;
            background: linear-gradient(180deg, #4CAF50 0%, #45A049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn:disabled {
            background: linear-gradient(180deg, #666 0%, #444 100%);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn.swing {
            background: linear-gradient(180deg, #FF5722 0%, #E64A19 100%);
        }

        .control-btn.pitch {
            background: linear-gradient(180deg, #2196F3 0%, #1976D2 100%);
        }

        /* Power Meter */
        .power-meter {
            position: absolute;
            bottom: 200px;
            left: 20px;
            width: 40px;
            height: 200px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            border-radius: 20px;
            overflow: hidden;
            z-index: 85;
        }

        .power-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(180deg, #F44336 0%, #FFEB3B 50%, #4CAF50 100%);
            transition: height 0.1s;
            border-radius: 18px;
        }

        /* Feedback */
        .feedback-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            z-index: 200;
            pointer-events: none;
            animation: feedbackAnim 1.5s ease-out forwards;
        }

        @keyframes feedbackAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }

        .feedback-msg.home-run {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Screens */
        .title-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #B83C21 0%, #1E3A5A 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .game-title {
            font-size: 48px;
            color: white;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            animation: titlePulse 2s infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .title-subtext {
            font-size: 20px;
            color: #FFD700;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Team Selection */
        .team-select {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #1E3A5A 0%, #B83C21 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .team-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 20px;
        }

        .team-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-width: 250px;
        }

        .team-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .team-logo {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .team-card-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .team-motto {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .state-rivals { color: #B83C21; }
        .college-legends { color: #1E3A5A; }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .field {
                width: 100vw;
                height: 100vh;
            }

            .infield {
                width: 300px;
                height: 300px;
            }

            .control-btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .game-title {
                font-size: 32px;
            }

            .feedback-msg {
                font-size: 32px;
            }

            .team-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* Loading State */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // Team Data
        const TEAMS = {
            stateRivals: {
                name: "State Rivals",
                color: "#B83C21",
                emoji: "🤠",
                motto: "Built Different Since 1883",
                players: [
                    { id: 1, name: "Rocket Rodriguez", pos: "P", power: 75, contact: 65, speed: 60, arm: 98, special: "Heater" },
                    { id: 2, name: "Thunder Thompson", pos: "C", power: 80, contact: 70, speed: 45, arm: 85, special: "Wall" },
                    { id: 3, name: "Flash Fernandez", pos: "1B", power: 90, contact: 75, speed: 50, arm: 70, special: "Crusher" },
                    { id: 4, name: "Wizard Williams", pos: "2B", power: 60, contact: 85, speed: 85, arm: 75, special: "Magic" },
                    { id: 5, name: "Hammer Hernandez", pos: "3B", power: 85, contact: 80, speed: 65, arm: 90, special: "Laser" },
                    { id: 6, name: "Lightning Lopez", pos: "SS", power: 70, contact: 85, speed: 90, arm: 85, special: "Theft" },
                    { id: 7, name: "Cannon Carter", pos: "LF", power: 85, contact: 75, speed: 75, arm: 95, special: "Rocket" },
                    { id: 8, name: "Speed Smith", pos: "CF", power: 65, contact: 80, speed: 95, arm: 80, special: "Jet" },
                    { id: 9, name: "Power Parker", pos: "RF", power: 95, contact: 70, speed: 60, arm: 90, special: "Bomb" }
                ]
            },
            collegeLegends: {
                name: "College Legends",
                color: "#1E3A5A",
                emoji: "⭐",
                motto: "Tradition Never Graduates",
                players: [
                    { id: 10, name: "Ace Anderson", pos: "P", power: 70, contact: 70, speed: 65, arm: 95, special: "Curve" },
                    { id: 11, name: "Tank Taylor", pos: "C", power: 85, contact: 65, speed: 40, arm: 80, special: "Block" },
                    { id: 12, name: "Slam Sullivan", pos: "1B", power: 95, contact: 70, speed: 45, arm: 65, special: "Launch" },
                    { id: 13, name: "Slick Sanders", pos: "2B", power: 55, contact: 90, speed: 90, arm: 70, special: "Turn" },
                    { id: 14, name: "Gold Gonzalez", pos: "3B", power: 80, contact: 85, speed: 70, arm: 95, special: "Glove" },
                    { id: 15, name: "Quick Quinn", pos: "SS", power: 65, contact: 85, speed: 95, arm: 90, special: "Range" },
                    { id: 16, name: "Blast Brown", pos: "LF", power: 90, contact: 70, speed: 70, arm: 85, special: "Power" },
                    { id: 17, name: "Hawk Harrison", pos: "CF", power: 75, contact: 75, speed: 90, arm: 85, special: "Eye" },
                    { id: 18, name: "Rifle Roberts", pos: "RF", power: 85, contact: 80, speed: 65, arm: 98, special: "Arm" }
                ]
            }
        };

        // Game Component
        function LoneStarLegends() {
            const [gameState, setGameState] = useState('title');
            const [playerTeam, setPlayerTeam] = useState(null);
            const [cpuTeam, setCpuTeam] = useState(null);
            const [inning, setInning] = useState(1);
            const [halfInning, setHalfInning] = useState('top');
            const [outs, setOuts] = useState(0);
            const [balls, setBalls] = useState(0);
            const [strikes, setStrikes] = useState(0);
            const [bases, setBases] = useState([null, null, null]);
            const [homeScore, setHomeScore] = useState(0);
            const [awayScore, setAwayScore] = useState(0);
            const [batting, setBatting] = useState(null);
            const [fielding, setFielding] = useState(null);
            const [currentBatter, setCurrentBatter] = useState(0);
            const [powerMeter, setPowerMeter] = useState(0);
            const [powerDirection, setPowerDirection] = useState(1);
            const [feedback, setFeedback] = useState(null);
            const [showPlayerCard, setShowPlayerCard] = useState(false);
            const [ballPosition, setBallPosition] = useState(null);
            const [pitchInProgress, setPitchInProgress] = useState(false);

            const powerIntervalRef = useRef(null);

            // Power Meter Effect
            useEffect(() => {
                if (gameState === 'playing' && batting === playerTeam) {
                    powerIntervalRef.current = setInterval(() => {
                        setPowerMeter(prev => {
                            let newPower = prev + powerDirection * 3;
                            if (newPower >= 100) {
                                setPowerDirection(-1);
                                return 100;
                            } else if (newPower <= 0) {
                                setPowerDirection(1);
                                return 0;
                            }
                            return newPower;
                        });
                    }, 30);
                } else {
                    if (powerIntervalRef.current) {
                        clearInterval(powerIntervalRef.current);
                    }
                }

                return () => {
                    if (powerIntervalRef.current) {
                        clearInterval(powerIntervalRef.current);
                    }
                };
            }, [gameState, batting, playerTeam, powerDirection]);

            // Start Game
            const startGame = () => {
                setGameState('teamSelect');
            };

            // Select Team
            const selectTeam = (teamKey) => {
                setPlayerTeam(teamKey);
                const cpu = teamKey === 'stateRivals' ? 'collegeLegends' : 'stateRivals';
                setCpuTeam(cpu);

                // Randomly decide who bats first
                if (Math.random() < 0.5) {
                    setBatting(teamKey);
                    setFielding(cpu);
                } else {
                    setBatting(cpu);
                    setFielding(teamKey);
                }

                setGameState('playing');
                setShowPlayerCard(true);
                setTimeout(() => setShowPlayerCard(false), 3000);

                // Start CPU at-bat if they're batting
                if (batting === cpu) {
                    setTimeout(() => cpuAtBat(), 1500);
                }
            };

            // Show Feedback
            const showFeedbackFunc = (message, isHomeRun = false) => {
                setFeedback({ message, isHomeRun });
                setTimeout(() => setFeedback(null), 1500);
            };

            // Pitch Action
            const pitch = useCallback(() => {
                if (pitchInProgress || fielding !== playerTeam) return;

                setPitchInProgress(true);
                const isStrike = Math.random() < 0.6;

                // Animate pitch
                setBallPosition({ x: 50, y: 65 });
                setTimeout(() => {
                    setBallPosition({ x: 50, y: 20 });

                    setTimeout(() => {
                        setBallPosition(null);

                        // CPU decides to swing
                        const swingChance = isStrike ? 0.7 : 0.3;
                        if (Math.random() < swingChance) {
                            const result = calculateHit(50, isStrike);
                            processResult(result);
                        } else {
                            if (isStrike) {
                                setStrikes(prev => prev + 1);
                                showFeedbackFunc("STRIKE!");
                            } else {
                                setBalls(prev => prev + 1);
                                showFeedbackFunc("BALL!");
                            }
                        }

                        setPitchInProgress(false);
                    }, 500);
                }, 100);
            }, [pitchInProgress, fielding, playerTeam]);

            // Swing Action
            const swing = useCallback(() => {
                if (pitchInProgress || batting !== playerTeam) return;

                setPitchInProgress(true);
                const isStrike = Math.random() < 0.65;
                const result = calculateHit(powerMeter, isStrike);

                // Animate pitch and swing
                setBallPosition({ x: 50, y: 65 });
                setTimeout(() => {
                    setBallPosition({ x: 50, y: 20 });

                    setTimeout(() => {
                        setBallPosition(null);
                        processResult(result);
                        setPitchInProgress(false);
                    }, 500);
                }, 100);
            }, [pitchInProgress, batting, playerTeam, powerMeter]);

            // Bunt Action
            const bunt = useCallback(() => {
                if (pitchInProgress || batting !== playerTeam) return;

                setPitchInProgress(true);
                const team = TEAMS[batting];
                const batter = team.players[currentBatter];
                const speed = batter.speed / 100;

                const result = Math.random() < speed * 0.7
                    ? { type: 'single', message: 'BUNT SINGLE!' }
                    : { type: 'out', message: 'BUNT OUT!' };

                processResult(result);
                setPitchInProgress(false);
            }, [pitchInProgress, batting, playerTeam, currentBatter]);

            // CPU At-Bat
            const cpuAtBat = useCallback(() => {
                if (batting !== cpuTeam) return;

                setTimeout(() => {
                    const swing = Math.random() < 0.7;
                    if (swing) {
                        const power = 40 + Math.random() * 60;
                        const result = calculateHit(power, true);
                        processResult(result);
                    } else {
                        // CPU doesn't swing, pitch result
                        const isStrike = Math.random() < 0.6;
                        if (isStrike) {
                            setStrikes(prev => prev + 1);
                            showFeedbackFunc("STRIKE!");
                        } else {
                            setBalls(prev => prev + 1);
                            showFeedbackFunc("BALL!");
                        }
                    }
                }, 1500);
            }, [batting, cpuTeam]);

            // Calculate Hit Result
            const calculateHit = (power, isStrike) => {
                const team = TEAMS[batting];
                const batter = team.players[currentBatter];
                const contactChance = (batter.contact / 100) * (isStrike ? 0.8 : 0.4);
                const powerMod = power / 100;

                if (Math.random() > contactChance) {
                    return { type: 'strike', message: 'STRIKE!' };
                }

                const hitPower = (batter.power / 100) * powerMod;
                const roll = Math.random();

                if (roll < 0.15) {
                    return { type: 'out', message: 'FLY OUT!' };
                } else if (roll < 0.3) {
                    return { type: 'groundout', message: 'GROUND OUT!' };
                } else if (roll < 0.6) {
                    return { type: 'single', message: 'SINGLE!' };
                } else if (roll < 0.8) {
                    return { type: 'double', message: 'DOUBLE!!' };
                } else if (roll < 0.92) {
                    return { type: 'triple', message: 'TRIPLE!!!' };
                } else {
                    return { type: 'homerun', message: 'HOME RUN!!!!' };
                }
            };

            // Process Result
            const processResult = (result) => {
                showFeedbackFunc(result.message, result.type === 'homerun');

                if (result.type === 'strike') {
                    const newStrikes = strikes + 1;
                    setStrikes(newStrikes);

                    if (newStrikes >= 3) {
                        showFeedbackFunc("STRIKEOUT!");
                        setTimeout(() => {
                            setOuts(prev => prev + 1);
                            resetCount();
                        }, 1000);
                    }
                } else if (result.type === 'out' || result.type === 'groundout') {
                    setOuts(prev => prev + 1);
                    resetCount();
                } else {
                    advanceRunners(result.type);
                    resetCount();
                    nextBatter();
                }
            };

            // Advance Runners
            const advanceRunners = (hitType) => {
                const advances = {
                    single: 1,
                    double: 2,
                    triple: 3,
                    homerun: 4
                };

                const advance = advances[hitType];
                let runs = 0;

                // Move existing runners
                const newBases = [...bases];
                for (let i = 2; i >= 0; i--) {
                    if (newBases[i] !== null) {
                        const newBase = i + advance;
                        if (newBase >= 3) {
                            runs++;
                            newBases[i] = null;
                        } else {
                            newBases[newBase] = newBases[i];
                            newBases[i] = null;
                        }
                    }
                }

                // Place batter on base (unless home run)
                if (hitType !== 'homerun') {
                    const team = TEAMS[batting];
                    newBases[advance - 1] = team.players[currentBatter];
                } else {
                    runs++;
                }

                setBases(newBases);

                // Update score
                if (halfInning === 'top') {
                    setAwayScore(prev => prev + runs);
                } else {
                    setHomeScore(prev => prev + runs);
                }
            };

            // Reset Count
            const resetCount = () => {
                setBalls(0);
                setStrikes(0);
            };

            // Next Batter
            const nextBatter = () => {
                setCurrentBatter(prev => (prev + 1) % 9);
                setShowPlayerCard(true);
                setTimeout(() => setShowPlayerCard(false), 3000);

                if (batting === cpuTeam) {
                    setTimeout(() => cpuAtBat(), 1500);
                }
            };

            // Check for end of half inning
            useEffect(() => {
                if (outs >= 3) {
                    // End half inning
                    setTimeout(() => {
                        setOuts(0);
                        setBases([null, null, null]);
                        resetCount();

                        if (halfInning === 'top') {
                            setHalfInning('bottom');
                            setBatting(fielding);
                            setFielding(batting);
                        } else {
                            setHalfInning('top');
                            setBatting(fielding);
                            setFielding(batting);
                            setInning(prev => prev + 1);

                            if (inning >= 9) {
                                // Check for game end
                                if (homeScore !== awayScore) {
                                    endGame();
                                    return;
                                }
                            }
                        }

                        setCurrentBatter(0);
                        setShowPlayerCard(true);
                        setTimeout(() => setShowPlayerCard(false), 3000);

                        // Start CPU at-bat if needed
                        if (batting === cpuTeam) {
                            setTimeout(() => cpuAtBat(), 1500);
                        }
                    }, 1500);
                }
            }, [outs]);

            // Check count for walks/strikeouts
            useEffect(() => {
                if (balls >= 4) {
                    showFeedbackFunc("WALK!");
                    setTimeout(() => {
                        // Handle walk logic
                        const newBases = [...bases];
                        if (newBases[0] !== null) {
                            if (newBases[1] !== null) {
                                if (newBases[2] !== null) {
                                    // Bases loaded, score run
                                    if (halfInning === 'top') {
                                        setAwayScore(prev => prev + 1);
                                    } else {
                                        setHomeScore(prev => prev + 1);
                                    }
                                }
                                newBases[2] = newBases[1];
                            }
                            newBases[1] = newBases[0];
                        }
                        const team = TEAMS[batting];
                        newBases[0] = team.players[currentBatter];

                        setBases(newBases);
                        resetCount();
                        nextBatter();
                    }, 1000);
                }
            }, [balls]);

            // End Game
            const endGame = () => {
                const winner = homeScore > awayScore ? 'HOME' : 'AWAY';
                const winnerTeam = winner === 'HOME' 
                    ? (halfInning === 'top' ? fielding : batting)
                    : (halfInning === 'top' ? batting : fielding);

                showFeedbackFunc(`${TEAMS[winnerTeam].name.toUpperCase()} WINS!`);

                setTimeout(() => {
                    if (confirm(`Game Over! ${TEAMS[winnerTeam].name} wins ${homeScore}-${awayScore}! Play again?`)) {
                        window.location.reload();
                    }
                }, 2000);
            };

            // Get inning suffix
            const getInningSuffix = (num) => {
                if (num === 1) return 'st';
                if (num === 2) return 'nd';
                if (num === 3) return 'rd';
                return 'th';
            };

            // Get current batter
            const getCurrentBatter = () => {
                if (!batting) return null;
                return TEAMS[batting].players[currentBatter];
            };

            // Render title screen
            if (gameState === 'title') {
                return (
                    <div className="game-container">
                        <div className="title-screen">
                            <h1 className="game-title">⚾ LONE STAR LEGENDS ⚾</h1>
                            <p className="title-subtext">Championship Baseball</p>
                            <button className="control-btn" onClick={startGame}>
                                PLAY BALL
                            </button>
                        </div>
                    </div>
                );
            }

            // Render team selection
            if (gameState === 'teamSelect') {
                return (
                    <div className="game-container">
                        <div className="team-select">
                            <h2 style={{ color: 'white', fontSize: '32px', marginBottom: '30px', textShadow: '2px 2px 4px rgba(0,0,0,0.5)' }}>
                                Choose Your Dynasty
                            </h2>
                            <div className="team-grid">
                                <div className="team-card" onClick={() => selectTeam('stateRivals')}>
                                    <div className="team-logo">{TEAMS.stateRivals.emoji}</div>
                                    <div className="team-card-name state-rivals">{TEAMS.stateRivals.name}</div>
                                    <div className="team-motto">{TEAMS.stateRivals.motto}</div>
                                </div>
                                <div className="team-card" onClick={() => selectTeam('collegeLegends')}>
                                    <div className="team-logo">{TEAMS.collegeLegends.emoji}</div>
                                    <div className="team-card-name college-legends">{TEAMS.collegeLegends.name}</div>
                                    <div className="team-motto">{TEAMS.collegeLegends.motto}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Render game
            return (
                <div className="game-container">
                    {/* Field */}
                    <div className="field">
                        <div className="warning-track"></div>
                        <div className="outfield"></div>
                        <div className="infield"></div>
                        
                        {/* Bases */}
                        <div className={`base base-first ${bases[0] ? 'occupied' : ''}`}></div>
                        <div className={`base base-second ${bases[1] ? 'occupied' : ''}`}></div>
                        <div className={`base base-third ${bases[2] ? 'occupied' : ''}`}></div>
                        <div className="base base-home"></div>
                        
                        {/* Pitcher's Mound */}
                        <div className="pitchers-mound"></div>
                        
                        {/* Players */}
                        {fielding && (
                            <>
                                {/* Pitcher */}
                                <div className="player" style={{ bottom: '280px', left: '50%', transform: 'translateX(-50%)' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                
                                {/* Catcher */}
                                <div className="player" style={{ bottom: '80px', left: '50%', transform: 'translateX(-50%)' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        🧤
                                    </div>
                                </div>
                                
                                {/* Fielders */}
                                <div className="player" style={{ bottom: '250px', right: '120px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '350px', right: '200px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '250px', left: '120px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '350px', left: '200px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '450px', left: '100px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '500px', left: '50%', transform: 'translateX(-50%)' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                                <div className="player" style={{ bottom: '450px', right: '100px' }}>
                                    <div className="player-body" style={{ background: TEAMS[fielding].color }}>
                                        ⚾
                                    </div>
                                </div>
                            </>
                        )}
                        
                        {/* Batter */}
                        {batting && (
                            <div className="player" style={{ bottom: '100px', left: '50%', transform: 'translateX(-50%)' }}>
                                <div className="player-body" style={{ background: TEAMS[batting].color }}>
                                    🏏
                                </div>
                            </div>
                        )}
                        
                        {/* Ball */}
                        {ballPosition && (
                            <div 
                                className="ball"
                                style={{
                                    display: 'block',
                                    bottom: `${ballPosition.y}%`,
                                    left: `${ballPosition.x}%`,
                                    transform: 'translate(-50%, -50%)'
                                }}
                            ></div>
                        )}
                    </div>

                    {/* HUD */}
                    <div className="hud">
                        <div className="scoreboard">
                            <div className="team-score">
                                <div className="team-name">HOME</div>
                                <div className="score">{homeScore}</div>
                            </div>
                            <div className="inning-display">
                                <div className="inning-half">{halfInning.toUpperCase()}</div>
                                <div className="inning-number">{inning}{getInningSuffix(inning)}</div>
                            </div>
                            <div className="team-score">
                                <div className="team-name">AWAY</div>
                                <div className="score">{awayScore}</div>
                            </div>
                        </div>
                    </div>

                    {/* Game Status */}
                    <div className="game-status">
                        <div className="status-row">
                            <span className="status-label">BALLS</span>
                            <div className="status-dots">
                                {[1, 2, 3, 4].map(i => (
                                    <div key={i} className={`status-dot ball ${i <= balls ? 'active' : ''}`}></div>
                                ))}
                            </div>
                        </div>
                        <div className="status-row">
                            <span className="status-label">STRIKES</span>
                            <div className="status-dots">
                                {[1, 2, 3].map(i => (
                                    <div key={i} className={`status-dot strike ${i <= strikes ? 'active' : ''}`}></div>
                                ))}
                            </div>
                        </div>
                        <div className="status-row">
                            <span className="status-label">OUTS</span>
                            <div className="status-dots">
                                {[1, 2, 3].map(i => (
                                    <div key={i} className={`status-dot out ${i <= outs ? 'active' : ''}`}></div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Player Card */}
                    {showPlayerCard && getCurrentBatter() && (
                        <div className="player-card active">
                            <div className="player-name">{getCurrentBatter().name}</div>
                            <div className="player-stats">
                                <div className="stat-item">
                                    <span className="stat-label">PWR:</span>
                                    <span className="stat-value">{getCurrentBatter().power}</span>
                                </div>
                                <div className="stat-item">
                                    <span className="stat-label">CON:</span>
                                    <span className="stat-value">{getCurrentBatter().contact}</span>
                                </div>
                                <div className="stat-item">
                                    <span className="stat-label">SPD:</span>
                                    <span className="stat-value">{getCurrentBatter().speed}</span>
                                </div>
                                <div className="stat-item">
                                    <span className="stat-label">ARM:</span>
                                    <span className="stat-value">{getCurrentBatter().arm}</span>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Power Meter */}
                    {batting === playerTeam && (
                        <div className="power-meter">
                            <div className="power-fill" style={{ height: `${powerMeter}%` }}></div>
                        </div>
                    )}

                    {/* Controls */}
                    <div className="controls">
                        {fielding === playerTeam ? (
                            <button 
                                className="control-btn pitch" 
                                onClick={pitch}
                                disabled={pitchInProgress}
                            >
                                PITCH
                            </button>
                        ) : (
                            <>
                                <button 
                                    className="control-btn swing" 
                                    onClick={swing}
                                    disabled={pitchInProgress}
                                >
                                    SWING
                                </button>
                                <button 
                                    className="control-btn" 
                                    onClick={bunt}
                                    disabled={pitchInProgress}
                                >
                                    BUNT
                                </button>
                            </>
                        )}
                    </div>

                    {/* Feedback */}
                    {feedback && (
                        <div className={`feedback-msg ${feedback.isHomeRun ? 'home-run' : ''}`}>
                            {feedback.message}
                        </div>
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<LoneStarLegends />, document.getElementById('root'));

        // Prevent iOS bounce scrolling
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>