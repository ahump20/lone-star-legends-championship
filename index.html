<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Lone Star Legends - Championship Baseball</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #98D982 40%, #8B7355 100%);
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        #root {
            width: 100%;
            height: 100%;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Field Styles */
        .field {
            position: absolute;
            width: 800px;
            height: 800px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .infield {
            position: absolute;
            width: 400px;
            height: 400px;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            background: radial-gradient(ellipse at center, #8B7355 0%, #7A6248 100%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        .outfield {
            position: absolute;
            width: 800px;
            height: 600px;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(ellipse at bottom, #7CB342 0%, #689F38 100%);
            border-radius: 50% 50% 0 0;
            z-index: -1;
        }

        .warning-track {
            position: absolute;
            width: 900px;
            height: 650px;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: transparent;
            border: 20px solid #8B7355;
            border-radius: 50% 50% 0 0;
            border-bottom: none;
            z-index: -2;
        }

        /* Base Styles */
        .base {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFFFFF 0%, #F0F0F0 100%);
            border: 2px solid #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 10;
            transition: all 0.3s;
        }

        .base.occupied {
            background: linear-gradient(135deg, #4CAF50 0%, #45A049 100%);
            animation: basePulse 1s infinite;
        }

        @keyframes basePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .base-first { bottom: 250px; right: 150px; }
        .base-second { bottom: 400px; left: 50%; transform: translateX(-50%); }
        .base-third { bottom: 250px; left: 150px; }
        .base-home {
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
        }

        .pitchers-mound {
            position: absolute;
            width: 80px;
            height: 80px;
            bottom: 280px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle, #8B7355 0%, #6B5245 100%);
            border-radius: 50%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            z-index: 11;
        }

        /* Player Styles */
        .player {
            position: absolute;
            width: 50px;
            height: 50px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
        }

        .player-body {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            color: white;
        }

        .player.running {
            animation: playerRun 0.5s infinite;
        }

        @keyframes playerRun {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-5deg); }
            75% { transform: translateY(-5px) rotate(5deg); }
        }

        /* Ball */
        .ball {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF, #F0F0F0);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 30;
            transition: all 0.4s cubic-bezier(0.55, 0.085, 0.68, 0.53);
        }

        .ball.flying {
            animation: ballFly 1s ease-out;
        }

        @keyframes ballFly {
            0% { transform: scale(1); }
            50% { transform: scale(0.6); }
            100% { transform: scale(1.2); }
        }

        /* HUD Styles */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.5) 100%);
            color: white;
            z-index: 100;
        }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .team-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .team-name {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .score {
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .inning-display {
            text-align: center;
        }

        .inning-number {
            font-size: 24px;
            font-weight: bold;
        }

        .inning-half {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Game Status */
        .game-status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 90;
        }

        .status-row {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .status-label {
            width: 60px;
            font-size: 12px;
            opacity: 0.8;
        }

        .status-dots {
            display: flex;
            gap: 5px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }

        .status-dot.active.ball { background: #2196F3; box-shadow: 0 0 5px #2196F3; }
        .status-dot.active.strike { background: #F44336; box-shadow: 0 0 5px #F44336; }
        .status-dot.active.out { background: #FFD700; box-shadow: 0 0 5px #FFD700; }

        /* Player Card */
        .player-card {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            backdrop-filter: blur(10px);
            z-index: 90;
            transform: translateY(150%);
            transition: transform 0.4s ease-out;
        }

        .player-card.active {
            transform: translateY(0);
        }

        .player-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
        }

        .stat-label {
            opacity: 0.7;
        }

        .stat-value {
            font-weight: bold;
        }

        /* Controls */
        .controls {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 95;
        }

        .control-btn {
            padding: 15px 30px;
            background: linear-gradient(180deg, #4CAF50 0%, #45A049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn:disabled {
            background: linear-gradient(180deg, #666 0%, #444 100%);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn.swing {
            background: linear-gradient(180deg, #FF5722 0%, #E64A19 100%);
        }

        .control-btn.pitch {
            background: linear-gradient(180deg, #2196F3 0%, #1976D2 100%);
        }

        /* Power Meter */
        .power-meter {
            position: absolute;
            bottom: 200px;
            left: 20px;
            width: 40px;
            height: 200px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            border-radius: 20px;
            overflow: hidden;
            z-index: 85;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .power-meter.active {
            opacity: 1;
        }

        .power-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(0deg, #4CAF50 0%, #FFEB3B 50%, #F44336 100%);
            transition: height 0.05s linear;
        }

        /* Feedback */
        .feedback-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            z-index: 200;
            pointer-events: none;
            animation: feedbackAnim 1.5s ease-out forwards;
        }

        @keyframes feedbackAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }

        .feedback-msg.home-run {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        .screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .title-screen {
            background: linear-gradient(135deg, #B83C21 0%, #1E3A5A 100%);
        }

        .game-title {
            font-size: 48px;
            color: white;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            animation: titlePulse 2s infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .title-subtext {
            font-size: 20px;
            color: #FFD700;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Team Selection */
        .team-select {
            background: linear-gradient(180deg, #1E3A5A 0%, #B83C21 100%);
        }

        .team-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 20px;
        }

        .team-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-width: 250px;
        }

        .team-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .team-logo {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .team-card-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .team-motto {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .state-rivals { color: #B83C21; }
        .college-legends { color: #1E3A5A; }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .field {
                width: 100vw;
                height: 100vh;
            }

            .infield {
                width: 300px;
                height: 300px;
            }

            .control-btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .game-title {
                font-size: 32px;
            }

            .feedback-msg {
                font-size: 32px;
            }

            .team-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- CONSTANTS ---
        const TEAMS = {
            stateRivals: {
                name: "State Rivals",
                color: "#B83C21",
                emoji: "🤠",
                motto: "Built Different Since 1883",
                players: [
                    { id: 1, name: "Rocket Rodriguez", pos: "P", power: 75, contact: 65, speed: 60, arm: 98 },
                    { id: 2, name: "Thunder Thompson", pos: "C", power: 80, contact: 70, speed: 45, arm: 85 },
                    { id: 3, name: "Flash Fernandez", pos: "1B", power: 90, contact: 75, speed: 50, arm: 70 },
                    { id: 4, name: "Wizard Williams", pos: "2B", power: 60, contact: 85, speed: 85, arm: 75 },
                    { id: 5, name: "Hammer Hernandez", pos: "3B", power: 85, contact: 80, speed: 65, arm: 90 },
                    { id: 6, name: "Lightning Lopez", pos: "SS", power: 70, contact: 85, speed: 90, arm: 85 },
                    { id: 7, name: "Cannon Carter", pos: "LF", power: 85, contact: 75, speed: 75, arm: 95 },
                    { id: 8, name: "Speed Smith", pos: "CF", power: 65, contact: 80, speed: 95, arm: 80 },
                    { id: 9, name: "Power Parker", pos: "RF", power: 95, contact: 70, speed: 60, arm: 90 }
                ]
            },
            collegeLegends: {
                name: "College Legends",
                color: "#1E3A5A",
                emoji: "⭐",
                motto: "Tradition Never Graduates",
                players: [
                    { id: 10, name: "Ace Anderson", pos: "P", power: 70, contact: 70, speed: 65, arm: 95 },
                    { id: 11, name: "Tank Taylor", pos: "C", power: 85, contact: 65, speed: 40, arm: 80 },
                    { id: 12, name: "Slam Sullivan", pos: "1B", power: 95, contact: 70, speed: 45, arm: 65 },
                    { id: 13, name: "Slick Sanders", pos: "2B", power: 55, contact: 90, speed: 90, arm: 70 },
                    { id: 14, name: "Gold Gonzalez", pos: "3B", power: 80, contact: 85, speed: 70, arm: 95 },
                    { id: 15, name: "Quick Quinn", pos: "SS", power: 65, contact: 85, speed: 95, arm: 90 },
                    { id: 16, name: "Blast Brown", pos: "LF", power: 90, contact: 70, speed: 70, arm: 85 },
                    { id: 17, name: "Hawk Harrison", pos: "CF", power: 75, contact: 75, speed: 90, arm: 85 },
                    { id: 18, name: "Rifle Roberts", pos: "RF", power: 85, contact: 80, speed: 65, arm: 98 }
                ]
            }
        };
        const PITCH_SPEED = 400; // ms for ball to reach plate
        const POST_PLAY_DELAY = 1500; // ms to pause after a play concludes

        // --- GAME HOOK ---
        function useGameLogic() {
            const [gameState, setGameState] = useState({
                screen: 'title', // title, teamSelect, playing, gameOver
                playerTeamId: null,
                cpuTeamId: null,
                battingTeamId: null,
                fieldingTeamId: null,
                inning: 1,
                halfInning: 'top',
                outs: 0,
                balls: 0,
                strikes: 0,
                bases: [null, null, null], // [1B, 2B, 3B]
                homeScore: 0,
                awayScore: 0,
                currentBatterIndex: 0,
                feedback: null, // { message, isHomeRun }
                isActionInProgress: false,
            });

            const timeoutRef = useRef(null);

            const updateGameState = (newState) => {
                setGameState(prev => ({ ...prev, ...newState }));
            };

            const showFeedback = (message, isHomeRun = false) => {
                updateGameState({ feedback: { message, isHomeRun } });
                setTimeout(() => updateGameState({ feedback: null }), POST_PLAY_DELAY);
            };
            
            const advanceInning = useCallback(() => {
                updateGameState({
                    outs: 0,
                    balls: 0,
                    strikes: 0,
                    bases: [null, null, null],
                    battingTeamId: gameState.fieldingTeamId,
                    fieldingTeamId: gameState.battingTeamId,
                    currentBatterIndex: 0,
                    halfInning: gameState.halfInning === 'top' ? 'bottom' : 'top',
                    inning: gameState.halfInning === 'bottom' ? gameState.inning + 1 : gameState.inning,
                });
            }, [gameState.fieldingTeamId, gameState.battingTeamId, gameState.halfInning, gameState.inning]);
            
            // Effect to handle game state progression (outs, innings)
            useEffect(() => {
                if (gameState.isActionInProgress) return;
                
                if (gameState.outs >= 3) {
                    showFeedback("CHANGE SIDES!");
                    timeoutRef.current = setTimeout(advanceInning, POST_PLAY_DELAY);
                    return;
                }
                if (gameState.balls >= 4) {
                    showFeedback("WALK!");
                    timeoutRef.current = setTimeout(() => handlePlayResult({ type: 'walk' }), POST_PLAY_DELAY);
                    return;
                }
                if (gameState.strikes >= 3) {
                    showFeedback("STRIKEOUT!");
                    timeoutRef.current = setTimeout(() => handlePlayResult({ type: 'out' }), POST_PLAY_DELAY);
                    return;
                }
                 // Check for game over
                if (gameState.inning > 9 && gameState.halfInning === 'top' && gameState.homeScore !== gameState.awayScore) {
                    updateGameState({ screen: 'gameOver' });
                }

            }, [gameState.outs, gameState.balls, gameState.strikes, gameState.isActionInProgress]);


            const handlePlayResult = useCallback((result) => {
                const advanceMap = { single: 1, double: 2, triple: 3, homerun: 4, walk: 1 };
                let runsScored = 0;
                let newBases = [...gameState.bases];
                const batter = TEAMS[gameState.battingTeamId].players[gameState.currentBatterIndex];

                if (result.type in advanceMap) {
                    const numBases = advanceMap[result.type];
                    const isWalk = result.type === 'walk';

                    // Move runners on base
                    for (let i = 2; i >= 0; i--) {
                        if (newBases[i]) {
                            // On a walk, only advance if forced
                            if (isWalk && !newBases.slice(0, i).every(b => b)) continue;
                            
                            const newBaseIndex = i + numBases;
                            if (newBaseIndex >= 3) {
                                runsScored++;
                                newBases[i] = null;
                            } else {
                                newBases[newBaseIndex] = newBases[i];
                                newBases[i] = null;
                            }
                        }
                    }

                    // Place batter
                    if (result.type === 'homerun') {
                        runsScored++;
                    } else {
                        newBases[numBases - 1] = batter;
                    }
                }

                // Update score
                const newScores = { homeScore: gameState.homeScore, awayScore: gameState.awayScore };
                if (runsScored > 0) {
                    if (gameState.battingTeamId === gameState.playerTeamId) {
                        newScores.homeScore += runsScored;
                    } else {
                        newScores.awayScore += runsScored;
                    }
                }
                
                updateGameState({
                    bases: newBases,
                    ...newScores,
                    balls: 0,
                    strikes: 0,
                    outs: result.type === 'out' ? gameState.outs + 1 : gameState.outs,
                    currentBatterIndex: (gameState.currentBatterIndex + 1) % 9,
                    isActionInProgress: false,
                });

            }, [gameState.bases, gameState.battingTeamId, gameState.currentBatterIndex, gameState.outs, gameState.playerTeamId, gameState.homeScore, gameState.awayScore]);

            const handlePitch = useCallback((isGoodPitch, swingPower) => {
                const batter = TEAMS[gameState.battingTeamId].players[gameState.currentBatterIndex];
                const didSwing = swingPower !== null;
                
                if (!didSwing) {
                    showFeedback(isGoodPitch ? "STRIKE!" : "BALL!");
                    updateGameState({ 
                        strikes: gameState.strikes + (isGoodPitch ? 1 : 0),
                        balls: gameState.balls + (isGoodPitch ? 0 : 1),
                        isActionInProgress: false 
                    });
                    return;
                }

                // Calculate hit result
                const contactChance = (batter.contact / 100) * (isGoodPitch ? 0.9 : 0.4);
                if (Math.random() > contactChance) {
                    showFeedback("SWING AND A MISS!");
                    updateGameState({ strikes: gameState.strikes + 1, isActionInProgress: false });
                    return;
                }

                const hitPower = (batter.power / 100) * (swingPower / 100);
                const roll = Math.random() + (hitPower * 0.2);
                
                let result;
                if (roll < 0.3) result = { type: 'out', message: 'GROUND OUT!' };
                else if (roll < 0.7) result = { type: 'single', message: 'SINGLE!' };
                else if (roll < 0.85) result = { type: 'double', message: 'DOUBLE!' };
                else if (roll < 0.95) result = { type: 'triple', message: 'TRIPLE!' };
                else result = { type: 'homerun', message: 'HOME RUN!!!' };

                showFeedback(result.message, result.type === 'homerun');
                timeoutRef.current = setTimeout(() => handlePlayResult(result), POST_PLAY_DELAY);

            }, [gameState.battingTeamId, gameState.currentBatterIndex, gameState.strikes, gameState.balls, handlePlayResult]);

            // Cleanup timeouts on unmount
            useEffect(() => () => clearTimeout(timeoutRef.current), []);

            return { gameState, updateGameState, handlePitch, showFeedback };
        }

        // --- COMPONENTS ---
        const TitleScreen = ({ onStart }) => (
            <div className="screen title-screen">
                <h1 className="game-title">⚾ LONE STAR LEGENDS ⚾</h1>
                <p className="title-subtext">Championship Baseball</p>
                <button className="control-btn" onClick={onStart}>PLAY BALL</button>
            </div>
        );

        const TeamSelectScreen = ({ onSelect }) => (
            <div className="screen team-select">
                <h2 style={{ color: 'white', fontSize: '32px', marginBottom: '30px', textShadow: '2px 2px 4px rgba(0,0,0,0.5)' }}>
                    Choose Your Dynasty
                </h2>
                <div className="team-grid">
                    {Object.entries(TEAMS).map(([key, team]) => (
                        <div key={key} className="team-card" onClick={() => onSelect(key)}>
                            <div className="team-logo">{team.emoji}</div>
                            <div className={`team-card-name ${key}`}>{team.name}</div>
                            <div className="team-motto">{team.motto}</div>
                        </div>
                    ))}
                </div>
            </div>
        );
        
        const Field = ({ gameState }) => {
            const { fieldingTeamId, battingTeamId, bases } = gameState;
            if (!fieldingTeamId || !battingTeamId) return null;

            const fieldPositions = {
                P: { bottom: '280px', left: '50%', transform: 'translateX(-50%)' },
                C: { bottom: '80px', left: '50%', transform: 'translateX(-50%)' },
                '1B': { bottom: '250px', right: '120px' },
                '2B': { bottom: '350px', right: '280px' },
                '3B': { bottom: '250px', left: '120px' },
                'SS': { bottom: '350px', left: '280px' },
                'LF': { bottom: '450px', left: '100px' },
                'CF': { bottom: '500px', left: '50%', transform: 'translateX(-50%)' },
                'RF': { bottom: '450px', right: '100px' }
            };

            return (
                <div className="field">
                    <div className="warning-track"></div>
                    <div className="outfield"></div>
                    <div className="infield"></div>
                    <div className={`base base-first ${bases[0] ? 'occupied' : ''}`}></div>
                    <div className={`base base-second ${bases[1] ? 'occupied' : ''}`}></div>
                    <div className={`base base-third ${bases[2] ? 'occupied' : ''}`}></div>
                    <div className="base base-home"></div>
                    <div className="pitchers-mound"></div>
                    
                    {/* Fielders */}
                    {TEAMS[fieldingTeamId].players.map(player => {
                        if (!fieldPositions[player.pos]) return null;
                        return (
                             <div key={player.id} className="player" style={fieldPositions[player.pos]}>
                                <div className="player-body" style={{ background: TEAMS[fieldingTeamId].color }}>⚾</div>
                            </div>
                        )
                    })}
                    
                    {/* Batter */}
                    <div className="player" style={{ bottom: '100px', left: '50%', transform: 'translateX(-50%)' }}>
                        <div className="player-body" style={{ background: TEAMS[battingTeamId].color }}>🏏</div>
                    </div>
                </div>
            )
        };
        
        const Hud = ({ gameState }) => {
            const { homeScore, awayScore, inning, halfInning, playerTeamId, cpuTeamId } = gameState;
            if (!playerTeamId || !cpuTeamId) return null;
            
            const getInningSuffix = (num) => {
                if (num % 10 === 1 && num % 100 !== 11) return 'st';
                if (num % 10 === 2 && num % 100 !== 12) return 'nd';
                if (num % 10 === 3 && num % 100 !== 13) return 'rd';
                return 'th';
            };

            return (
                <div className="hud">
                    <div className="scoreboard">
                        <div className="team-score">
                            <div className="team-name">{TEAMS[playerTeamId].name.toUpperCase()}</div>
                            <div className="score">{homeScore}</div>
                        </div>
                        <div className="inning-display">
                            <div className="inning-half">{halfInning.toUpperCase()}</div>
                            <div className="inning-number">{inning}{getInningSuffix(inning)}</div>
                        </div>
                        <div className="team-score">
                            <div className="team-name">{TEAMS[cpuTeamId].name.toUpperCase()}</div>
                            <div className="score">{awayScore}</div>
                        </div>
                    </div>
                </div>
            )
        };
        
        const GameStatus = ({ balls, strikes, outs }) => (
            <div className="game-status">
                <div className="status-row">
                    <span className="status-label">BALLS</span>
                    <div className="status-dots">
                        {[...Array(4)].map((_, i) => <div key={i} className={`status-dot ball ${i < balls ? 'active' : ''}`}></div>)}
                    </div>
                </div>
                <div className="status-row">
                    <span className="status-label">STRIKES</span>
                    <div className="status-dots">
                        {[...Array(3)].map((_, i) => <div key={i} className={`status-dot strike ${i < strikes ? 'active' : ''}`}></div>)}
                    </div>
                </div>
                <div className="status-row">
                    <span className="status-label">OUTS</span>
                    <div className="status-dots">
                        {[...Array(3)].map((_, i) => <div key={i} className={`status-dot out ${i < outs ? 'active' : ''}`}></div>)}
                    </div>
                </div>
            </div>
        );
        
        const PlayerCard = ({ batter }) => {
            const [isActive, setIsActive] = useState(false);
            useEffect(() => {
                if (batter) {
                    setIsActive(true);
                    const timer = setTimeout(() => setIsActive(false), 2500);
                    return () => clearTimeout(timer);
                }
            }, [batter]);

            if (!batter) return null;
            
            return (
                <div className={`player-card ${isActive ? 'active' : ''}`}>
                    <div className="player-name">{batter.name}</div>
                    <div className="player-stats">
                        <div className="stat-item"><span className="stat-label">PWR:</span><span className="stat-value">{batter.power}</span></div>
                        <div className="stat-item"><span className="stat-label">CON:</span><span className="stat-value">{batter.contact}</span></div>
                        <div className="stat-item"><span className="stat-label">SPD:</span><span className="stat-value">{batter.speed}</span></div>
                        <div className="stat-item"><span className="stat-label">ARM:</span><span className="stat-value">{batter.arm}</span></div>
                    </div>
                </div>
            )
        };

        const Controls = ({ gameState, onPitch, onSwing, onBunt }) => {
            const { playerTeamId, battingTeamId, isActionInProgress } = gameState;
            const isPlayerBatting = playerTeamId === battingTeamId;

            return (
                 <div className="controls">
                    {isPlayerBatting ? (
                        <>
                            <button className="control-btn swing" onClick={onSwing} disabled={isActionInProgress}>SWING</button>
                            <button className="control-btn" onClick={onBunt} disabled={isActionInProgress}>BUNT</button>
                        </>
                    ) : (
                        <button className="control-btn pitch" onClick={onPitch} disabled={isActionInProgress}>PITCH</button>
                    )}
                </div>
            )
        };
        
        const PowerMeter = ({ isActive }) => {
            const [power, setPower] = useState(0);
            const directionRef = useRef(1);

            useEffect(() => {
                if (isActive) {
                    const interval = setInterval(() => {
                        setPower(p => {
                            const newPower = p + directionRef.current * 2;
                            if (newPower >= 100) directionRef.current = -1;
                            if (newPower <= 0) directionRef.current = 1;
                            return Math.max(0, Math.min(100, newPower));
                        });
                    }, 20);
                    return () => clearInterval(interval);
                }
            }, [isActive]);

            return (
                <div className={`power-meter ${isActive ? 'active' : ''}`}>
                    <div className="power-fill" style={{ height: `${power}%` }}></div>
                </div>
            )
        };

        // --- MAIN APP COMPONENT ---
        function LoneStarLegends() {
            const { gameState, updateGameState, handlePitch, showFeedback } = useGameLogic();
            const { screen, playerTeamId, cpuTeamId, battingTeamId, currentBatterIndex, isActionInProgress } = gameState;
            
            const [ballPosition, setBallPosition] = useState(null);
            const swingPowerRef = useRef(0);

            // --- CPU Logic ---
            useEffect(() => {
                if (screen === 'playing' && battingTeamId === cpuTeamId && !isActionInProgress) {
                    const timer = setTimeout(() => {
                         const isGoodPitch = Math.random() < 0.65;
                         setBallPosition({ start: true });
                         setTimeout(() => {
                            setBallPosition({ start: false });
                            handlePitch(isGoodPitch, null); // CPU takes the pitch
                         }, PITCH_SPEED);
                    }, POST_PLAY_DELAY);
                    return () => clearTimeout(timer);
                }
            }, [screen, battingTeamId, cpuTeamId, isActionInProgress, handlePitch]);
            
            const handleSelectTeam = (teamId) => {
                const cpuId = teamId === 'stateRivals' ? 'collegeLegends' : 'stateRivals';
                const isPlayerBatting = Math.random() < 0.5;
                updateGameState({
                    screen: 'playing',
                    playerTeamId: teamId,
                    cpuTeamId: cpuId,
                    battingTeamId: isPlayerBatting ? teamId : cpuId,
                    fieldingTeamId: isPlayerBatting ? cpuId : teamId,
                    homeScore: 0,
                    awayScore: 0,
                });
            };
            
            const handlePlayerPitch = () => {
                if (isActionInProgress) return;
                updateGameState({ isActionInProgress: true });
                
                const isGoodPitch = Math.random() < 0.65;
                const batter = TEAMS[cpuTeamId].players[currentBatterIndex];
                const swingChance = (batter.contact / 150) + (isGoodPitch ? 0.3 : 0);

                setBallPosition({ start: true });
                setTimeout(() => {
                    setBallPosition({ start: false });
                    if (Math.random() < swingChance) {
                        handlePitch(isGoodPitch, 40 + Math.random() * 50); // CPU swings with random power
                    } else {
                        handlePitch(isGoodPitch, null); // CPU takes
                    }
                }, PITCH_SPEED);
            };

            const handlePlayerSwing = () => {
                // This would be triggered by a button, which would capture the power meter value
                // For now, we simulate it
                console.log("Swing logic to be implemented");
            };

            if (screen === 'title') {
                return <TitleScreen onStart={() => updateGameState({ screen: 'teamSelect' })} />;
            }
            if (screen === 'teamSelect') {
                return <TeamSelectScreen onSelect={handleSelectTeam} />;
            }
            
            const currentBatter = battingTeamId ? TEAMS[battingTeamId].players[currentBatterIndex] : null;

            return (
                <div className="game-container">
                    <Field gameState={gameState} />
                    <Hud gameState={gameState} />
                    <GameStatus {...gameState} />
                    <PlayerCard batter={currentBatter} />
                    
                    {ballPosition && <div className="ball" style={{
                        bottom: ballPosition.start ? '280px' : '100px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        opacity: ballPosition.start ? 1 : 0,
                    }}/>}    
                    <Controls gameState={gameState} onPitch={handlePlayerPitch} onSwing={handlePlayerSwing} onBunt={() => {}} />
                    
                    {gameState.feedback && (
                        <div className={`feedback-msg ${gameState.feedback.isHomeRun ? 'home-run' : ''}`}>
                            {gameState.feedback.message}
                        </div>
                    )}
                    
                    {gameState.screen === 'gameOver' && (
                         <div className="screen" style={{background: 'rgba(0,0,0,0.7)'}}>
                            <h1 className="game-title">GAME OVER</h1>
                             <p className="title-subtext">{gameState.homeScore > gameState.awayScore ? TEAMS[playerTeamId].name : TEAMS[cpuTeamId].name} WINS!</p>
                            <button className="control-btn" onClick={() => window.location.reload()}>Play Again</button>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<LoneStarLegends />, document.getElementById('root'));

        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>