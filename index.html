<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Lone Star Legends: Championship Edition (Integrated)</title>
    <!--
      This file merges the visual design from the updated Lone Star Legends UI with
      a simplified but complete game engine.  The game loop, scoring, base
      running and CPU batting logic come from the previous working prototype,
      while the styling and layout reflect the more polished version.  The
      result is a playable baseball simulator with modern UI elements and a
      balanced set of probabilities for pitches, hits and outs.
    -->
    <style>
        /* === CORE RESET & VARIABLES === */
        :root {
            /* Austin-Inspired Psychological Color System */
            --burnt-orange: #BF5700;
            --charcoal: #333F48;
            --limestone: #D6D2C4;
            --sky-blue: #005F86;
            --gold-accent: #FFB81C;
            --emerald-success: #00A86B;
            --fire-red: #CC5500;
            --electric-blue: #00B4D8;
            --field-green: #4B7F52;
            --dirt-brown: #8B6F47;
            --warning-track: #6B5245;

            /* UI Colors */
            --ui-dark: #1A1A1A;
            --ui-medium: #2D2D2D;
            --ui-light: #F5F5F0;
            --ui-glass: rgba(26, 26, 26, 0.85);
            --ui-glow: rgba(191, 87, 0, 0.4);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        @font-face {
            font-family: 'Athletic';
            src: local('Impact'), local('Arial Black'), local('sans-serif');
        }
        body {
            font-family: 'Athletic', 'Arial Black', sans-serif;
            background: linear-gradient(180deg, 
                var(--sky-blue) 0%, 
                #87CEEB 30%,
                var(--field-green) 60%, 
                var(--dirt-brown) 100%);
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        /* === LOADING SCREEN === */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--charcoal);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        .loading-logo {
            width: 150px;
            height: 150px;
            position: relative;
            animation: rotateLogo 2s infinite linear;
        }
        @keyframes rotateLogo {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .loading-text {
            color: var(--burnt-orange);
            font-size: 24px;
            margin-top: 30px;
            text-shadow: 0 0 20px rgba(191, 87, 0, 0.5);
            animation: pulse 1.5s infinite;
        }
        /* === TITLE SCREEN === */
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                var(--charcoal) 0%, 
                var(--burnt-orange) 50%, 
                var(--charcoal) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .game-logo {
            position: relative;
            margin-bottom: 30px;
        }
        .game-title {
            font-size: clamp(36px, 8vw, 72px);
            color: var(--ui-light);
            text-shadow: 
                3px 3px 0 var(--charcoal),
                6px 6px 0 var(--burnt-orange),
                9px 9px 20px rgba(0,0,0,0.8);
            letter-spacing: 3px;
            animation: titleFloat 3s ease-in-out infinite;
        }
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .game-subtitle {
            font-size: 20px;
            color: var(--gold-accent);
            margin-bottom: 50px;
            text-transform: uppercase;
            letter-spacing: 5px;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; text-shadow: 0 0 20px var(--gold-accent); }
        }
        /* === TEAM SELECTION === */
        #teamSelect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, 
                var(--charcoal) 0%, 
                #1A1A1A 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .team-select-title {
            font-size: 48px;
            color: var(--burnt-orange);
            margin-bottom: 50px;
            text-shadow: 0 0 30px rgba(191, 87, 0, 0.5);
        }
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            padding: 20px;
            max-width: 800px;
        }
        .team-card {
            background: linear-gradient(145deg, 
                var(--ui-glass) 0%, 
                rgba(51, 63, 72, 0.9) 100%);
            border: 2px solid var(--burnt-orange);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            color: white;
        }
        .team-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, 
                transparent 30%, 
                var(--ui-glow) 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .team-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(191, 87, 0, 0.4);
        }
        .team-card:hover::before {
            opacity: 1;
            animation: rotate 3s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* === 3D FIELD === */
        #gameField {
            position: absolute;
            width: 100%;
            height: 100%;
            perspective: 1000px;
            display: none;
        }
        .field-container {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(20deg);
        }
        .field-surface {
            position: absolute;
            width: 800px;
            height: 800px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: conic-gradient(
                from 45deg at 50% 100%,
                var(--field-green) 0deg,
                var(--field-green) 90deg,
                var(--dirt-brown) 90deg,
                var(--dirt-brown) 180deg,
                var(--field-green) 180deg,
                var(--field-green) 270deg,
                var(--dirt-brown) 270deg
            );
            border-radius: 50% 50% 0 0;
            box-shadow: 
                inset 0 0 100px rgba(0,0,0,0.4),
                0 20px 40px rgba(0,0,0,0.3);
        }
        /* === PLAYER SPRITES === */
        .player-sprite {
            position: absolute;
            width: 60px;
            height: 80px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
            transform-style: preserve-3d;
        }
        .player-body {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.2s;
        }
        .player-sprite.pitching .player-body {
            animation: pitchMotion 0.5s ease-in-out;
        }
        @keyframes pitchMotion {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(-15deg) scale(1.1); }
            100% { transform: rotate(10deg) scale(1); }
        }
        .player-sprite.swinging .player-body {
            animation: swingMotion 0.3s ease-out;
        }
        @keyframes swingMotion {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(45deg); }
            100% { transform: rotate(0deg); }
        }
        .player-head {
            width: 25px;
            height: 25px;
            background: #FFD4B2;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: inset -2px -2px 4px rgba(0,0,0,0.2);
        }
        .player-cap {
            width: 28px;
            height: 15px;
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50% 50% 0 0;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.3);
        }
        .player-jersey {
            width: 35px;
            height: 35px;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .player-pants {
            width: 30px;
            height: 25px;
            background: #CCCCCC;
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 0 0 5px 5px;
        }
        .player-shadow {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 15px;
            background: radial-gradient(ellipse, 
                rgba(0,0,0,0.4) 0%, 
                transparent 70%);
            border-radius: 50%;
        }
        .player-sprite.running {
            animation: playerRun 0.5s infinite;
        }
        @keyframes playerRun {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-8px) rotate(-5deg); }
            75% { transform: translateY(-8px) rotate(5deg); }
        }
        /* === ENHANCED BALL === */
        .game-ball {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, 
                #FFFFFF, 
                #F0F0F0 50%, 
                #E0E0E0);
            border-radius: 50%;
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.3),
                inset -2px -2px 4px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
            transform-style: preserve-3d;
        }
        .game-ball.flying {
            animation: ballFly 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        @keyframes ballFly {
            0% { 
                transform: scale(1) translateZ(0);
                filter: blur(0);
            }
            50% { 
                transform: scale(0.6) translateZ(200px);
                filter: blur(2px);
            }
            100% { 
                transform: scale(1.2) translateZ(0);
                filter: blur(0);
            }
        }
        /* === HUD === */
        #gameHUD {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(180deg, 
                var(--ui-glass) 0%, 
                transparent 100%);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none;
        }
        .hud-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
        }
        .team-score-panel {
            background: var(--ui-glass);
            border: 2px solid var(--burnt-orange);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .team-score-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--gold-accent) 50%, 
                transparent 100%);
            animation: scanline 2s infinite;
        }
        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .team-name {
            font-size: 14px;
            color: var(--gold-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        .team-score {
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        .inning-display {
            background: var(--charcoal);
            border: 3px solid var(--burnt-orange);
            border-radius: 20px;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .inning-half {
            font-size: 12px;
            color: var(--gold-accent);
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        .inning-number {
            font-size: 36px;
            color: white;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(191, 87, 0, 0.5);
        }
        /* === GAME STATUS === */
        #gameStatus {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--ui-glass);
            border: 2px solid var(--burnt-orange);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(15px);
            z-index: 90;
            display: none;
        }
        .status-grid {
            display: grid;
            gap: 15px;
        }
        .status-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .status-label {
            width: 80px;
            font-size: 14px;
            color: var(--gold-accent);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .status-indicators {
            display: flex;
            gap: 8px;
        }
        .indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            position: relative;
        }
        .indicator.active {
            animation: indicatorPulse 1s infinite;
        }
        .indicator.ball.active {
            background: var(--electric-blue);
            box-shadow: 0 0 20px var(--electric-blue);
        }
        .indicator.strike.active {
            background: var(--fire-red);
            box-shadow: 0 0 20px var(--fire-red);
        }
        .indicator.out.active {
            background: var(--gold-accent);
            box-shadow: 0 0 20px var(--gold-accent);
        }
        @keyframes indicatorPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        /* === PLAYER CARD === */
        #playerCard {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: var(--ui-glass);
            border: 2px solid var(--burnt-orange);
            border-radius: 20px;
            padding: 25px;
            min-width: 280px;
            backdrop-filter: blur(15px);
            z-index: 90;
            transform: translateY(150%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
        }
        #playerCard.active {
            transform: translateY(0);
        }
        .player-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .player-portrait {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--burnt-orange), var(--charcoal));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .player-info {
            flex: 1;
        }
        .player-name {
            font-size: 18px;
            color: var(--gold-accent);
            font-weight: bold;
            margin-bottom: 5px;
        }
        .player-position {
            font-size: 14px;
            color: white;
            opacity: 0.8;
        }
        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .stat-item {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-label {
            font-size: 10px;
            color: var(--gold-accent);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .stat-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        .stat-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s;
        }
        /* === CONTROL BUTTONS === */
        #gameControls {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 95;
        }
        .control-btn {
            padding: 20px 40px;
            background: linear-gradient(135deg, 
                var(--burnt-orange) 0%, 
                var(--fire-red) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .control-btn:disabled {
            background: linear-gradient(135deg, #666 0%, #444 100%);
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* === PITCH SELECTION (unused in integrated version) === */
        #pitchSelection {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--ui-glass);
            border: 3px solid var(--burnt-orange);
            border-radius: 20px;
            padding: 30px;
            display: none;
            backdrop-filter: blur(15px);
            z-index: 200;
            color: white;
        }
        .pitch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .pitch-option {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .pitch-option:hover {
            border-color: var(--gold-accent);
            background: rgba(191, 87, 0, 0.2);
        }
        .pitch-name {
            font-size: 14px;
            color: white;
            margin-bottom: 5px;
        }
        .pitch-stats {
            font-size: 10px;
            color: var(--gold-accent);
        }
        /* === POWER METER (unused in integrated version) === */
        #powerMeter {
            position: fixed;
            bottom: 250px;
            left: 50px;
            width: 60px;
            height: 250px;
            background: var(--ui-glass);
            border: 3px solid var(--burnt-orange);
            border-radius: 30px;
            overflow: hidden;
            z-index: 85;
            display: none;
            backdrop-filter: blur(10px);
        }
        #powerFill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(0deg, 
                var(--emerald-success) 0%, 
                var(--gold-accent) 50%, 
                var(--fire-red) 100%);
            transition: height 0.05s linear;
        }
        .power-zones {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .power-zone {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.3);
        }
        .power-zone.sweet { bottom: 65%; }
        .power-zone.good { bottom: 40%; }
        /* === FEEDBACK MESSAGES === */
        .feedback-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(36px, 6vw, 72px);
            font-weight: bold;
            color: white;
            text-shadow: 
                2px 2px 0 var(--charcoal),
                4px 4px 0 var(--burnt-orange),
                6px 6px 20px rgba(0,0,0,0.8);
            z-index: 300;
            pointer-events: none;
            opacity: 0;
        }
        .feedback-msg.active {
             animation: feedbackAnim 2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        @keyframes feedbackAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            40% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }
        .feedback-msg.home-run {
            background: linear-gradient(45deg, 
                var(--gold-accent), 
                var(--burnt-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: homeRunAnim 3s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        @keyframes homeRunAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-360deg);
                opacity: 0;
            }
            30% {
                transform: translate(-50%, -50%) scale(1.5) rotate(20deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
                opacity: 0;
            }
        }
        /* === STREAK COUNTER === */
        #streakCounter {
            position: fixed;
            top: 100px;
            left: 30px;
            background: var(--ui-glass);
            border: 2px solid var(--burnt-orange);
            border-radius: 15px;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            display: none;
            z-index: 90;
        }
        .streak-label {
            font-size: 12px;
            color: var(--gold-accent);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .streak-value {
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .streak-fire {
            display: inline-block;
            margin-left: 10px;
            animation: fire 0.5s infinite alternate;
        }
        @keyframes fire {
            from { transform: scale(1) rotate(-5deg); }
            to { transform: scale(1.2) rotate(5deg); }
        }
        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .hud-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .team-score-panel {
                flex-direction: row;
                justify-content: space-between;
            }
            #gameStatus {
                bottom: 20px;
                right: 20px;
                padding: 15px;
            }
            #playerCard {
                bottom: 20px;
                left: 20px;
                min-width: 240px;
            }
            .control-btn {
                padding: 15px 25px;
                font-size: 14px;
            }
            #powerMeter {
                width: 50px;
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-logo">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="none" stroke="#BF5700" stroke-width="2"/>
                <path d="M50 5 L65 35 L95 35 L70 55 L80 85 L50 65 L20 85 L30 55 L5 35 L35 35 Z" 
                      fill="#BF5700" opacity="0.8"/>
            </svg>
        </div>
        <div class="loading-text">LOADING LEGENDS...</div>
    </div>
    <!-- Title Screen -->
    <div id="titleScreen">
        <div class="game-logo">
            <h1 class="game-title">LONE STAR LEGENDS</h1>
            <div class="game-subtitle">Championship Edition</div>
        </div>
        <button class="control-btn" onclick="game.showTeamSelect()">PLAY BALL</button>
        <button class="control-btn" onclick="game.showStats()" style="margin-top: 20px;">HALL OF FAME</button>
    </div>
    <!-- Team Selection -->
    <div id="teamSelect">
        <h2 class="team-select-title">CHOOSE YOUR DYNASTY</h2>
        <div class="team-grid">
            <div class="team-card" onclick="game.selectTeam('heroes')">
                <div style="font-size: 72px; text-align: center; margin-bottom: 20px;">‚≠ê</div>
                <h3 style="color: var(--burnt-orange); font-size: 24px; margin-bottom: 10px;">Houston Heroes</h3>
                <p style="color: var(--gold-accent); font-style: italic; margin-bottom: 20px;">"Space City Heroes"</p>
                <div>Featuring: Ace Anderson, Mighty Mike, Big Brett, Catcher Carl</div>
            </div>
            <div class="team-card" onclick="game.selectTeam('drifters')">
                <div style="font-size: 72px; text-align: center; margin-bottom: 20px;">ü§†</div>
                <h3 style="color: var(--electric-blue); font-size: 24px; margin-bottom: 10px;">Dallas Drifters</h3>
                <p style="color: var(--gold-accent); font-style: italic; margin-bottom: 20px;">"Always Forward"</p>
                <div>Featuring: Pitcher Paul, Catcher Chris, Third Base Tony, Shortstop Shane</div>
            </div>
        </div>
    </div>
    <!-- Game Field -->
    <div id="gameField">
        <div class="field-container">
            <div class="field-surface"></div>
            <div id="playersContainer"></div>
            <div class="game-ball" id="gameBall"></div>
        </div>
    </div>
    <!-- HUD -->
    <div id="gameHUD">
        <div class="hud-container">
            <div class="team-score-panel">
                <div class="team-name" id="awayTeamName">AWAY</div>
                <div class="team-score" id="awayScore">0</div>
            </div>
            <div class="inning-display">
                <div class="inning-half" id="inningHalf">TOP</div>
                <div class="inning-number" id="inningNumber">1</div>
            </div>
            <div class="team-score-panel">
                <div class="team-name" id="homeTeamName">HOME</div>
                <div class="team-score" id="homeScore">0</div>
            </div>
        </div>
    </div>
    <!-- Game Status -->
    <div id="gameStatus">
        <div class="status-grid">
            <div class="status-row">
                <span class="status-label">BALLS</span>
                <div class="status-indicators" id="balls"></div>
            </div>
            <div class="status-row">
                <span class="status-label">STRIKES</span>
                <div class="status-indicators" id="strikes"></div>
            </div>
            <div class="status-row">
                <span class="status-label">OUTS</span>
                <div class="status-indicators" id="outs"></div>
            </div>
        </div>
    </div>
    <!-- Player Card -->
    <div id="playerCard">
        <div class="player-card-header">
            <div class="player-portrait" id="playerPortrait">‚öæ</div>
            <div class="player-info">
                <div class="player-name" id="playerName">Player Name</div>
                <div class="player-position" id="playerPosition">Position</div>
            </div>
        </div>
        <div class="player-stats-grid">
            <div class="stat-item">
                <div class="stat-label">PWR</div>
                <div class="stat-value" id="statPower">0</div>
                <div class="stat-bar"><div class="stat-fill" id="powerBar" style="background: var(--fire-red);"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">CON</div>
                <div class="stat-value" id="statContact">0</div>
                <div class="stat-bar"><div class="stat-fill" id="contactBar" style="background: var(--electric-blue);"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">SPD</div>
                <div class="stat-value" id="statSpeed">0</div>
                <div class="stat-bar"><div class="stat-fill" id="speedBar" style="background: var(--emerald-success);"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ARM</div>
                <div class="stat-value" id="statArm">0</div>
                <div class="stat-bar"><div class="stat-fill" id="armBar" style="background: var(--gold-accent);"></div></div>
            </div>
        </div>
    </div>
    <!-- Power Meter (unused) -->
    <div id="powerMeter">
        <div id="powerFill" style="height: 0%;"></div>
        <div class="power-zones">
            <div class="power-zone sweet"></div>
            <div class="power-zone good"></div>
        </div>
    </div>
    <!-- Pitch Selection (unused) -->
    <div id="pitchSelection">
        <h3 style="color: var(--gold-accent); margin-bottom: 20px;">SELECT PITCH</h3>
        <div class="pitch-grid"></div>
    </div>
    <!-- Streak Counter (unused) -->
    <div id="streakCounter">
        <div class="streak-label">WIN STREAK</div>
        <div class="streak-value"><span id="streakValue">0</span><span class="streak-fire">üî•</span></div>
    </div>
    <!-- Controls -->
    <div id="gameControls">
        <!-- When pitching, show the pitch selection instead of immediately simulating a pitch -->
        <button class="control-btn" id="pitchBtn" onclick="game.
/*
 * Show a visible pitch animation by moving the ball element from the
 * pitcher towards home plate.  A callback is invoked when the ball
 * reaches the plate to continue game logic.  This gives the batter
 * time to see the pitch and makes swinging a timing event rather
 * than an instant outcome.
 */
playPitchAnimation(callback) {
    const ballEl = this.dom.gameBall;
    if (!ballEl) {
        if (callback) callback();
        return;
    }
    // Reset ball appearance at the pitcher's release point
    ballEl.style.display = 'block';
    ballEl.style.transition = '';
    ballEl.style.bottom = '45%';
    ballEl.style.left = '50%';
    ballEl.style.transform = 'translateX(-50%) scale(1)';
    // Delay slightly then animate towards the plate
    setTimeout(() => {
        ballEl.style.transition = 'all 0.5s ease';
        ballEl.style.bottom = '20%';
        ballEl.style.transform = 'translateX(-50%) scale(0.5)';
        // After the animation completes, hide the ball and run the callback
        setTimeout(() => {
            ballEl.style.display = 'none';
            ballEl.style.transition = '';
            if (typeof callback === 'function') {
                callback();
            }
        }, 500);
    }, 50);
}
showPitchSelection()">PITCH</button>
        <button class="control-btn" id="swingBtn" onclick="game.swing()">SWING</button>
        <button class="control-btn" id="stealBtn" onclick="game.attemptSteal()">STEAL</button>
    </div>
    
    <script>
    // Integrated game logic.  This class merges the polished UI with a
    // simplified but complete baseball simulation.  Players select one
    // of two Texas dynasties and face off against a CPU.  Each at-bat
    // produces balls, strikes, hits or outs based on player stats and
    // tuned probabilities.  Runners advance appropriately and the
    // scoreboard updates in real time.  A half inning ends after three
    // outs and the game lasts three full innings.
    class LoneStarLegendsGame {
        constructor() {
            // Define rosters for both teams.  Only basic batting stats are
            // required (power, contact, speed, arm).  Pitchers include a
            // 'pitches' property but it is unused in this simplified engine.
            this.teams = {
                heroes: {
                    name: 'Houston Heroes',
                    color: '#BF5700',
                    players: [
                        { name: 'Ace Anderson', pos: 'P', num: 34, power: 75, contact: 65, speed: 70, arm: 99, clutch: 95 },
                        { name: 'Mighty Mike', pos: '2B', num: 27, power: 80, contact: 95, speed: 90, arm: 85, clutch: 94 },
                        { name: 'Big Brett', pos: '1B', num: 5, power: 95, contact: 85, speed: 60, arm: 75, clutch: 92 },
                        { name: 'Catcher Carl', pos: 'C', num: 7, power: 70, contact: 88, speed: 85, arm: 80, clutch: 90 },
                        { name: 'Third Base Theo', pos: '3B', num: 2, power: 85, contact: 88, speed: 70, arm: 90, clutch: 93 },
                        { name: 'Speedy Sam', pos: 'CF', num: 4, power: 88, contact: 80, speed: 85, arm: 88, clutch: 90 },
                        { name: 'Slugger Larry', pos: 'LF', num: 17, power: 90, contact: 85, speed: 65, arm: 85, clutch: 91 },
                        { name: 'Shortstop Stu', pos: 'SS', num: 1, power: 85, contact: 85, speed: 75, arm: 95, clutch: 88 },
                        { name: 'Power Pete', pos: 'RF', num: 44, power: 98, contact: 82, speed: 55, arm: 70, clutch: 89 }
                    ]
                },
                drifters: {
                    name: 'Dallas Drifters',
                    color: '#003278',
                    players: [
                        { name: 'Pitcher Paul', pos: 'P', num: 31, power: 70, contact: 70, speed: 65, arm: 95, clutch: 92 },
                        { name: 'Catcher Chris', pos: 'C', num: 7, power: 80, contact: 85, speed: 70, arm: 95, clutch: 94 },
                        { name: 'First Base Frank', pos: '1B', num: 25, power: 92, contact: 85, speed: 60, arm: 75, clutch: 88 },
                        { name: 'Second Base Steve', pos: '2B', num: 5, power: 78, contact: 85, speed: 88, arm: 82, clutch: 86 },
                        { name: 'Third Base Tony', pos: '3B', num: 29, power: 88, contact: 88, speed: 65, arm: 92, clutch: 95 },
                        { name: 'Shortstop Shane', pos: 'SS', num: 10, power: 75, contact: 90, speed: 75, arm: 85, clutch: 92 },
                        { name: 'Left Field Larry', pos: 'LF', num: 32, power: 94, contact: 82, speed: 80, arm: 88, clutch: 91 },
                        { name: 'Center Field Cody', pos: 'CF', num: 5, power: 86, contact: 88, speed: 72, arm: 88, clutch: 90 },
                        { name: 'Right Field Rick', pos: 'RF', num: 19, power: 96, contact: 80, speed: 70, arm: 90, clutch: 90 }
                    ]
                }
            };
            // Field positions (for placing defensive players on the 3D diamond)
            this.fieldPositions = {
                'P': { bottom: '45%', left: '50%', transform: 'translateX(-50%)' },
                'C': { bottom: '18%', left: '50%', transform: 'translateX(-50%)' },
                '1B': { bottom: '38%', left: '68%', transform: 'translateX(-50%)' },
                '2B': { bottom: '50%', left: '60%', transform: 'translateX(-50%)' },
                '3B': { bottom: '38%', left: '32%', transform: 'translateX(-50%)' },
                'SS': { bottom: '50%', left: '40%', transform: 'translateX(-50%)' },
                'LF': { bottom: '68%', left: '25%', transform: 'translateX(-50%)' },
                'CF': { bottom: '75%', left: '50%', transform: 'translateX(-50%)' },
                'RF': { bottom: '68%', left: '75%', transform: 'translateX(-50%)' }
            };
            // Base positions for runners (1=first, 2=second, 3=third, 4=home)
            this.basePositions = {
                1: { bottom: '38%', left: '68%', transform: 'translateX(-50%)' },
                2: { bottom: '50%', left: '50%', transform: 'translateX(-50%)' },
                3: { bottom: '38%', left: '32%', transform: 'translateX(-50%)' },
                4: { bottom: '18%', left: '50%', transform: 'translateX(-50%)' }
            };

        // Define a simple set of pitch types for the pitch selection UI. Each
        // pitch includes a display name and an indicative speed.  These
        // values are purely cosmetic in this simplified engine, but they
        // allow the player to pick a pitch when controlling the fielding
        // team.  Selecting a pitch will immediately throw the pitch to
        // the batter via cpuPitch().
        this.pitchTypes = {
            fastball: { name: 'FASTBALL', speed: 96 },
            curve:    { name: 'CURVEBALL', speed: 78 },
            slider:   { name: 'SLIDER', speed: 86 },
            changeup: { name: 'CHANGEUP', speed: 82 },
            knuckle:  { name: 'KNUCKLEBALL', speed: 68 },
            sinker:   { name: 'SINKER', speed: 90 }
        };
            // Initialise game state
            this.state = {
                inning: 1,
                halfInning: 'top',
                outs: 0,
                balls: 0,
                strikes: 0,
                bases: [null, null, null],
                homeScore: 0,
                awayScore: 0,
                playerTeam: null,
                cpuTeam: null,
                battingTeam: null,
                fieldingTeam: null,
                currentBatterIndex: 0,
                gameStarted: false,
                gameOver: false
            };
            // Cache DOM elements
            this.dom = {};
            this.cacheDomElements();
            // Start initialisation
            this.init();
        }
        cacheDomElements() {
            const ids = [
                'loadingScreen','titleScreen','teamSelect','gameField','gameHUD','gameStatus','playerCard',
                'powerMeter','pitchSelection','streakCounter','gameControls','awayTeamName','awayScore',
                'inningHalf','inningNumber','homeTeamName','homeScore','balls','strikes','outs','playerPortrait',
                'playerName','playerPosition','statPower','powerBar','statContact','contactBar','statSpeed',
                'speedBar','statArm','armBar','playersContainer','gameBall','pitchBtn','swingBtn','stealBtn'
            ];
            ids.forEach(id => { this.dom[id] = document.getElementById(id); });
            this.dom.pitchGrid = this.dom.pitchSelection.querySelector('.pitch-grid');
        }
        init() {
            // Hide loading screen after a short delay
            setTimeout(() => {
                this.dom.loadingScreen.style.opacity = '0';
                setTimeout(() => { this.dom.loadingScreen.style.display = 'none'; }, 500);
            }, 1500);
            // Set up key listeners
            document.addEventListener('keydown', (e) => {
                if (!this.state.gameStarted || this.state.gameOver) return;
                if (e.key === ' ') {
                    this.swing();
                }
            });
            // Initial UI state
            this.updateDisplay();
            // Enable or disable the steal button based on baserunners
            this.dom.stealBtn.disabled = !this.state.bases.some(b => b);
        }
        /* Show team selection menu */
        showTeamSelect() {
            this.dom.titleScreen.style.display = 'none';
            this.dom.teamSelect.style.display = 'flex';
        }
        /* Player selects a team and game starts */
        selectTeam(id) {
            this.state.playerTeam = id;
            this.state.cpuTeam = (id === 'heroes' ? 'drifters' : 'heroes');
            // Randomly decide who bats first
            if (Math.random() < 0.5) {
                this.state.battingTeam = this.state.playerTeam;
                this.state.fieldingTeam = this.state.cpuTeam;
            } else {
                this.state.battingTeam = this.state.cpuTeam;
                this.state.fieldingTeam = this.state.playerTeam;
            }
            // Set the half inning based on who is batting: CPU bats in the top, player bats in the bottom
            this.state.halfInning = (this.state.battingTeam === this.state.cpuTeam) ? 'top' : 'bottom';
            this.startGame();
        }
        /* Initialise the game UI and state for a new game */
        startGame() {
            this.state.gameStarted = true;
            this.state.gameOver = false;
            this.state.inning = 1;
            // Preserve halfInning from team selection; default to 'top' if not set
            if (!this.state.halfInning) {
                this.state.halfInning = 'top';
            }
            this.state.outs = 0;
            this.state.balls = 0;
            this.state.strikes = 0;
            this.state.bases = [null, null, null];
            this.state.currentBatterIndex = 0;
            // Hide selection menus and show game interfaces
            this.dom.teamSelect.style.display = 'none';
            this.dom.gameField.style.display = 'block';
            this.dom.gameHUD.style.display = 'block';
            this.dom.gameStatus.style.display = 'block';
            this.dom.gameControls.style.display = 'flex';
            this.dom.playerCard.style.display = 'block';
            // Update team names on HUD
            this.dom.homeTeamName.textContent = this.teams[this.state.playerTeam].name.toUpperCase();
            this.dom.awayTeamName.textContent = this.teams[this.state.cpuTeam].name.toUpperCase();
            // Begin the first at-bat
            this.nextBatter();
        }
        /* Set up fielders and batter for current play */
        setupField() {
            const container = this.dom.playersContainer;
            container.innerHTML = '';
            // Place fielders for the fielding team
            const fielding = this.teams[this.state.fieldingTeam];
            fielding.players.forEach(player => {
                const pos = this.fieldPositions[player.pos];
                if (pos) {
                    const sprite = this.createPlayerSprite(player, fielding.color);
                    Object.assign(sprite.style, pos);
                    container.appendChild(sprite);
                }
            });
            // Place current batter
            const batting = this.teams[this.state.battingTeam];
            const batter = batting.players[this.state.currentBatterIndex % batting.players.length];
            const batterSprite = this.createPlayerSprite(batter, batting.color);
            batterSprite.id = 'batter';
            batterSprite.style.bottom = '20%';
            batterSprite.style.left = '50%';
            batterSprite.style.transform = 'translateX(-50%)';
            container.appendChild(batterSprite);
            // Render base runners
            this.updateBaseRunnersUI();
        }
        /* Create a DOM element for a player sprite */
        createPlayerSprite(player, teamColor) {
            const el = document.createElement('div');
            el.className = 'player-sprite';
            el.innerHTML = `
                <div class="player-body">
                    <div class="player-head"></div>
                    <div class="player-cap" style="background:${teamColor}"></div>
                    <div class="player-jersey" style="background:${teamColor}">${player.num}</div>
                    <div class="player-pants"></div>
                    <div class="player-shadow"></div>
                </div>`;
            return el;
        }
        /* Display the current batter's stats in the player card */
        showPlayerCard(player) {
            this.dom.playerName.textContent = player.name.toUpperCase();
            this.dom.playerPosition.textContent = player.pos;
            this.dom.statPower.textContent = player.power;
            this.dom.powerBar.style.width = `${player.power}%`;
            this.dom.statContact.textContent = player.contact;
            this.dom.contactBar.style.width = `${player.contact}%`;
            this.dom.statSpeed.textContent = player.speed;
            this.dom.speedBar.style.width = `${player.speed}%`;
            this.dom.statArm.textContent = player.arm;
            this.dom.armBar.style.width = `${player.arm}%`;
            this.dom.playerCard.classList.add('active');
        }
        /* Start the next at-bat.  Resets counts and determines if CPU or player is batting. */
        nextBatter() {
            // If three outs have occurred, handle inning change
            if (this.state.outs >= 3) {
                this.changeSides();
                return;
            }
            // Reset count
            this.state.balls = 0;
            this.state.strikes = 0;
            // Determine the current batter (wrap around after 9)
            const battingLine = this.teams[this.state.battingTeam].players;
            this.state.currentBatterIndex = this.state.currentBatterIndex % battingLine.length;
            const batter = battingLine[this.state.currentBatterIndex];
            // Show batter card
            this.showPlayerCard(batter);
            // Place players on field
            this.setupField();
            // Update HUD counts
            this.updateDisplay();
            // Enable or disable the steal button based on baserunners
            this.dom.stealBtn.disabled = !this.state.bases.some(b => b);
            // Determine if CPU or player is batting
            if (this.state.battingTeam === this.state.cpuTeam) {
                // CPU at bat: disable swing button, enable pitch (for player's awareness)
                this.dom.swingBtn.disabled = true;
                this.dom.pitchBtn.disabled = false;
                // Simulate CPU pitch after a short delay
                setTimeout(() => this.cpuPitch(), 800);
            } else {
                // Player at bat: enable swing button, disable pitch
                this.dom.pitchBtn.disabled = true;
                this.dom.swingBtn.disabled = false;
            }
        }
        /* CPU pitching logic: simply generate an outcome for the current batter */
        
cpuPitch() {
    if (this.state.gameOver || !this.state.gameStarted) return;
    // Show a visible pitch animation before resolving the outcome
    this.playPitchAnimation(() => {
        const batter = this.teams[this.state.battingTeam].players[this.state.currentBatterIndex];
        const outcome = this.simulateOutcome(batter);
        this.processPitchOutcome(outcome);
    });
}

        /* Player swings at the pitch */
        
swing() {
    if (this.state.gameOver || !this.state.gameStarted) return;
    if (this.state.battingTeam !== this.state.playerTeam) return;
    // Disable swing button during pitch animation
    this.dom.swingBtn.disabled = true;
    this.playPitchAnimation(() => {
        const batter = this.teams[this.state.battingTeam].players[this.state.currentBatterIndex];
        const outcome = this.simulateOutcome(batter);
        this.processPitchOutcome(outcome);
        if (this.state.battingTeam === this.state.playerTeam) {
            this.dom.swingBtn.disabled = false;
        }
    });
}

        /* Core outcome simulation.  Uses player contact/power to skew
           probabilities of strikes, balls, hits and extra-base hits. */
        simulateOutcome(player) {
            // Clamp stats between 0 and 100
            const contact = Math.min(Math.max(player.contact, 0), 100);
            const power = Math.min(Math.max(player.power, 0), 100);
            /*
             * Base probabilities tuned to produce more realistic innings.  By
             * default there are far more strikes and balls than hits.  High
             * contact slightly increases the chance of a hit while reducing
             * strikes.  Hits are further subdivided into singles, doubles,
             * triples and home runs using the player's power.
             */
            // Base probabilities tuned for a more realistic balance of strikes, balls, hits and outs.
            // Start with more strikes than balls and hits, and include an explicit "out" probability.
            let probStrike = 0.55;
            let probBall   = 0.25;
            let probHit    = 0.15;
            let probOut    = 0.05;
            // Adjust based on contact: higher contact increases chance of a hit and decreases strikes and outs
            probStrike -= (contact - 50) * 0.001;
            probHit    += (contact - 50) * 0.0008;
            probOut    -= (contact - 50) * 0.0005;
            // Clamp probabilities to sensible ranges
            probStrike = Math.max(0.1, Math.min(probStrike, 0.9));
            probHit    = Math.max(0.05, Math.min(probHit, 0.6));
            probOut    = Math.max(0.02, Math.min(probOut, 0.3));
            // Recalculate ball probability to ensure sum to 1
            probBall = 1 - (probStrike + probHit + probOut);
            // Ensure ball probability has a minimum floor
            if (probBall < 0.05) probBall = 0.05;
            // Normalise again if needed
            const totalProb = probStrike + probBall + probHit + probOut;
            probStrike /= totalProb;
            probBall   /= totalProb;
            probHit    /= totalProb;
            probOut    /= totalProb;
            // Randomly select outcome based on cumulative probabilities
            const r = Math.random();
            if (r < probStrike) return { type: 'strike' };
            if (r < probStrike + probBall) return { type: 'ball' };
            if (r < probStrike + probBall + probOut) return { type: 'out' };
            // Hit occurred: determine type based on power and a secondary roll
            const hitRoll = Math.random();
            // Home run: high power and low probability
            if (power > 90 && hitRoll < 0.03) return { type: 'homerun' };
            // Triple: high power and slightly larger chance
            if (power > 80 && hitRoll < 0.07) return { type: 'triple' };
            // Double: moderate chance
            if (hitRoll < 0.2) return { type: 'double' };
            // Otherwise, single
            return { type: 'single' };
        }
        /* Process the outcome of a pitch */
        processPitchOutcome(outcome) {
            if (this.state.gameOver) return;
            // Display feedback and update state
            const show = (msg, type) => {
                this.showFeedback(msg, type);
            };
            switch (outcome.type) {
                case 'strike':
                    this.state.strikes++;
                    show('Strike!', '');
                    break;
                case 'ball':
                    this.state.balls++;
                    show('Ball!', '');
                    break;
                case 'single':
                    show('Single!', '');
                    this.advanceRunners(1);
                    break;
                case 'double':
                    show('Double!', '');
                    this.advanceRunners(2);
                    break;
                case 'triple':
                    show('Triple!', '');
                    this.advanceRunners(3);
                    break;
                case 'homerun':
                    show('Home Run!', 'home-run');
                    this.advanceRunners(4);
                    break;
                case 'out':
                    // Direct fielding out (pop up or ground out)
                    this.showFeedback('Out!', '');
                    this.handleOut();
                    return;
            }
            // Handle walks (four balls)
            if (this.state.balls >= 4) {
                this.advanceRunners(1);
                this.showFeedback('Walk!', '');
            }
            // Handle strikeouts
            if (this.state.strikes >= 3) {
                this.handleOut();
                return;
            }
            // Update the HUD
            this.updateDisplay();
            // Enable or disable the steal button based on baserunners
            this.dom.stealBtn.disabled = !this.state.bases.some(b => b);
            // Continue CPU batting if applicable
            if (this.state.battingTeam === this.state.cpuTeam && !this.state.gameOver) {
                if (outcome.type === 'strike' || outcome.type === 'ball') {
                    // Continue pitching after short delay
                    setTimeout(() => this.cpuPitch(), 600);
                } else {
                    // Hit: new batter
                    this.state.currentBatterIndex++;
                    this.nextBatter();
                }
            } else if (this.state.battingTeam === this.state.playerTeam) {
                // For player: if hit occurred, move to next batter
                if (['single','double','triple','homerun'].includes(outcome.type)) {
                    this.state.currentBatterIndex++;
                    this.nextBatter();
                }
            }
        }
        /* Advance all base runners and batter by the specified number of bases */
        advanceRunners(basesToAdvance) {
            let runs = 0;
            // Advance existing runners
            for (let i = 2; i >= 0; i--) {
                const runner = this.state.bases[i];
                if (runner) {
                    const newIndex = i + basesToAdvance;
                    if (newIndex >= 3) {
                        runs++;
                    } else {
                        this.state.bases[newIndex] = runner;
                    }
                    this.state.bases[i] = null;
                }
            }
            // Batter
            if (basesToAdvance >= 4) {
                runs++;
            } else {
                this.state.bases[basesToAdvance - 1] = this.teams[this.state.battingTeam].players[this.state.currentBatterIndex];
            }
            // Update score
            if (runs > 0) {
                if (this.state.battingTeam === this.state.playerTeam) {
                    this.state.homeScore += runs;
                } else {
                    this.state.awayScore += runs;
                }
                const msg = runs > 1 ? `${runs} Runs!` : 'Run!';
                this.showFeedback(msg, '');
            }
            // Refresh base runners UI
            this.updateBaseRunnersUI();
        }
        /* Remove current batter on strikes and handle outs */
        handleOut() {
            this.state.outs++;
            this.showFeedback('Out!', '');
            // Reset balls/strikes
            this.state.balls = 0;
            this.state.strikes = 0;
            // Move to next batter
            this.state.currentBatterIndex++;
            // Check for end of half-inning
            if (this.state.outs >= 3) {
                this.changeSides();
            } else {
                this.nextBatter();
            }
        }
        /* Change sides after three outs; handles inning and game over conditions */
        changeSides() {
            // Reset outs and counts
            this.state.outs = 0;
            this.state.balls = 0;
            this.state.strikes = 0;
            // Clear bases
            this.state.bases = [null, null, null];
            // Swap batting and fielding teams
            const oldBatting = this.state.battingTeam;
            this.state.battingTeam = this.state.fieldingTeam;
            this.state.fieldingTeam = oldBatting;
            // Reset batter index
            this.state.currentBatterIndex = 0;
            // Switch top/bottom or advance inning
            if (this.state.halfInning === 'top') {
                this.state.halfInning = 'bottom';
            } else {
                this.state.halfInning = 'top';
                this.state.inning++;
            }
            // Check for end of game (3 innings total)
            if (this.state.inning > 3) {
                this.endGame();
                return;
            }
            // Update field and continue
            this.updateBaseRunnersUI();
            this.nextBatter();
        }
        /* End the game and show final result */
        endGame() {
            this.state.gameOver = true;
            this.showFeedback('Game Over', '');
            let result;
            if (this.state.homeScore > this.state.awayScore) {
                result = 'You Win!';
            } else if (this.state.homeScore < this.state.awayScore) {
                result = 'You Lose!';
            } else {
                result = 'Tie Game!';
            }
            setTimeout(() => {
                this.showFeedback(result, '');
            }, 2000);
            // Disable controls
            this.dom.swingBtn.disabled = true;
            this.dom.pitchBtn.disabled = true;
            this.dom.stealBtn.disabled = true;
        }
        /* Render base runners on the field */
        updateBaseRunnersUI() {
            // Remove existing runner elements
            const container = this.dom.playersContainer;
            const existing = container.querySelectorAll('.base-runner');
            existing.forEach(el => el.remove());
            // Add new runners
            for (let i = 0; i < 3; i++) {
                const runner = this.state.bases[i];
                if (runner) {
                    const sprite = this.createPlayerSprite(runner, this.teams[this.state.battingTeam].color);
                    sprite.classList.add('base-runner');
                    Object.assign(sprite.style, this.basePositions[i + 1]);
                    container.appendChild(sprite);
                }
            }
            // Disable or enable the steal button based on whether a runner is on base
            this.dom.stealBtn.disabled = !this.state.bases.some((b) => b);
        }
        /* Update scoreboard and count indicators */
        updateDisplay() {
            // Update scores and inning
            this.dom.homeScore.textContent = this.state.homeScore;
            this.dom.awayScore.textContent = this.state.awayScore;
            this.dom.inningNumber.textContent = this.state.inning;
            this.dom.inningHalf.textContent = this.state.halfInning.toUpperCase();
            // Update ball/strike/out indicators
            const updateIndicators = (container, count, max, cls) => {
                container.innerHTML = '';
                for (let i = 0; i < max; i++) {
                    const dot = document.createElement('div');
                    dot.className = `indicator ${cls}`;
                    if (i < count) dot.classList.add('active');
                    container.appendChild(dot);
                }
            };
            updateIndicators(this.dom.balls, this.state.balls, 4, 'ball');
            updateIndicators(this.dom.strikes, this.state.strikes, 3, 'strike');
            updateIndicators(this.dom.outs, this.state.outs, 3, 'out');
        }
        /* Display an animated feedback message on the screen */
        showFeedback(message, type) {
            const msgEl = document.createElement('div');
            msgEl.className = 'feedback-msg';
            if (type === 'home-run') msgEl.classList.add('home-run');
            msgEl.textContent = message;
            document.body.appendChild(msgEl);
            // Trigger animation
            setTimeout(() => { msgEl.classList.add('active'); }, 50);
            // Remove after animation
            setTimeout(() => { msgEl.remove(); }, 2500);
        }

    /*
     * Display the pitch selection modal when the player is fielding and the
     * CPU is at bat.  Each pitch option is generated from the pitchTypes
     * list defined in the constructor.  Selecting a pitch hides the
     * modal and triggers cpuPitch() immediately.  Pitch types are
     * currently cosmetic and do not influence the outcome, but they
     * provide a richer user interaction.
     */
    showPitchSelection() {
        if (!this.state.gameStarted || this.state.gameOver) return;
        // Only allow pitch selection when the CPU is batting
        if (this.state.battingTeam !== this.state.cpuTeam) return;
        // Clear existing options and build a new grid
        this.dom.pitchGrid.innerHTML = '';
        Object.keys(this.pitchTypes).forEach((key) => {
            const pitch = this.pitchTypes[key];
            const el = document.createElement('div');
            el.className = 'pitch-option';
            el.innerHTML = `<div class="pitch-name">${pitch.name}</div><div class="pitch-stats">${pitch.speed} MPH</div>`;
            el.onclick = () => this.selectPitch(key);
            this.dom.pitchGrid.appendChild(el);
        });
        this.dom.pitchSelection.style.display = 'block';
    }

    /*
     * Record the selected pitch and immediately simulate the pitch.  The
     * selected pitch key is stored on state.selectedPitch for future
     * enhancements.  After selection, the pitch selection modal is
     * hidden and the cpuPitch() method is called to continue play.
     */
    selectPitch(pitchKey) {
        this.state.selectedPitch = pitchKey;
        this.dom.pitchSelection.style.display = 'none';
        this.cpuPitch();
    }
        /* Placeholder functions for unimplemented features */
        attemptSteal() {
            this.showFeedback('Steal feature coming soon!', '');
        }
        showStats() {
            alert('Hall of Fame coming soon!');
        }
    }
    // Create global game instance
    const game = new LoneStarLegendsGame();
    </script>
</body>
</html>