<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lone Star Legends: Championship Edition - Enhanced</title>
    
    <style>
        :root {
            --baseball-green: #2E8B57;
            --baseball-brown: #8B4513;
            --home-plate: #F5F5F5;
            --diamond-red: #DC143C;
            --sky-blue: #87CEEB;
            --grass-green: #228B22;
            --dugout-gray: #696969;
            --scoreboard-yellow: #FFD700;
            --text-dark: #2F2F2F;
            --text-light: #F0F0F0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--sky-blue), var(--grass-green));
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-text {
            font-size: 1.5em;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .loading-bar {
            width: 300px;
            height: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--scoreboard-yellow), var(--diamond-red));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .game-container {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-title {
            color: white;
            font-size: 2em;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .game-stats {
            display: flex;
            gap: 20px;
            color: white;
            font-size: 1.2em;
        }

        .stat-box {
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid var(--scoreboard-yellow);
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .view-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .view-btn {
            padding: 10px 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: 2px solid var(--scoreboard-yellow);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .view-btn:hover {
            background: var(--scoreboard-yellow);
            color: black;
        }

        .view-btn.active {
            background: var(--diamond-red);
            border-color: var(--diamond-red);
        }

        .mode-selector {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .mode-selector h2 {
            color: var(--baseball-green);
            margin-bottom: 30px;
            font-size: 2em;
        }

        .mode-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 20px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, var(--baseball-green), var(--grass-green));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .mode-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .controls-panel {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 100;
            width: 250px;
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section h3 {
            color: var(--baseball-brown);
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 2px solid var(--baseball-green);
            padding-bottom: 5px;
        }

        .control-btn {
            display: block;
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: linear-gradient(135deg, var(--baseball-green), var(--grass-green));
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, var(--grass-green), var(--baseball-green));
            transform: translateX(5px);
        }

        .info-display {
            position: absolute;
            left: 20px;
            top: 100px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--scoreboard-yellow);
            z-index: 100;
            min-width: 200px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .info-label {
            color: var(--scoreboard-yellow);
            font-weight: bold;
        }

        .info-value {
            color: white;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">⚾</div>
            <div class="loading-text">Lone Star Legends</div>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p style="color: rgba(255,255,255,0.7); margin-top: 10px;">Championship Edition</p>
        </div>
    </div>

    <!-- Mode Selector -->
    <div id="mode-selector" class="mode-selector">
        <h2>Select Game Mode</h2>
        <div class="mode-buttons">
            <button class="mode-btn" onclick="startGame('exhibition')">Exhibition Match</button>
            <button class="mode-btn" onclick="startGame('season')">Season Mode</button>
            <button class="mode-btn" onclick="startGame('homerun')">Home Run Derby</button>
            <button class="mode-btn" onclick="startGame('practice')">Practice Mode</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container" class="game-container">
        <!-- Game Header -->
        <div class="game-header">
            <div class="game-title">⭐ Lone Star Legends ⭐</div>
            <div class="game-stats">
                <div class="stat-box">
                    <span id="inning-display">Top 1st</span>
                </div>
                <div class="stat-box">
                    <span id="score-display">HOME 0 - 0 AWAY</span>
                </div>
                <div class="stat-box">
                    <span id="count-display">0-0</span>
                </div>
            </div>
        </div>

        <!-- Canvas Container (for both 2D and 3D) -->
        <div id="canvas-container"></div>

        <!-- View Controls -->
        <div class="view-controls">
            <button class="view-btn active" onclick="changeView('broadcast')">Broadcast</button>
            <button class="view-btn" onclick="changeView('pitcher')">Pitcher</button>
            <button class="view-btn" onclick="changeView('batter')">Batter</button>
            <button class="view-btn" onclick="changeView('overhead')">Overhead</button>
            <button class="view-btn" onclick="toggle2D3D()">Toggle 2D/3D</button>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="control-section">
                <h3>Pitching</h3>
                <button class="control-btn" onclick="pitch('fastball')">Fastball</button>
                <button class="control-btn" onclick="pitch('curveball')">Curveball</button>
                <button class="control-btn" onclick="pitch('slider')">Slider</button>
                <button class="control-btn" onclick="pitch('changeup')">Changeup</button>
            </div>
            
            <div class="control-section">
                <h3>Batting</h3>
                <button class="control-btn" onclick="swing('power')">Power Swing</button>
                <button class="control-btn" onclick="swing('contact')">Contact Swing</button>
                <button class="control-btn" onclick="swing('bunt')">Bunt</button>
            </div>
            
            <div class="control-section">
                <h3>Game</h3>
                <button class="control-btn" onclick="saveGame()">Save Game</button>
                <button class="control-btn" onclick="loadGame()">Load Game</button>
                <button class="control-btn" onclick="showStats()">Statistics</button>
                <button class="control-btn" onclick="pauseGame()">Pause</button>
            </div>
        </div>

        <!-- Info Display -->
        <div class="info-display">
            <div class="info-row">
                <span class="info-label">Outs:</span>
                <span class="info-value" id="outs-display">0</span>
            </div>
            <div class="info-row">
                <span class="info-label">At Bat:</span>
                <span class="info-value" id="batter-display">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Pitcher:</span>
                <span class="info-value" id="pitcher-display">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Wind:</span>
                <span class="info-value" id="wind-display">5 mph</span>
            </div>
        </div>
    </div>

    <!-- Load game modules -->
    <script type="module">
        // Import game modules
        import { GameEngine } from './engine.js';
        import EnhancedGameIntegration from './enhanced-game-integration.js';
        import Baseball3DField from './threejs-field-3d.js';
        
        // Global game variables
        window.gameEngine = null;
        window.enhancedGame = null;
        window.field3D = null;
        window.is3D = true;
        
        // Loading simulation
        function simulateLoading() {
            let progress = 0;
            const loadingBar = document.getElementById('loading-progress');
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loading-screen').style.display = 'none';
                            document.getElementById('mode-selector').style.display = 'block';
                        }, 500);
                    }, 500);
                }
                
                loadingBar.style.width = progress + '%';
            }, 200);
        }
        
        // Start game with selected mode
        window.startGame = async function(mode) {
            console.log('Starting game in', mode, 'mode');
            
            document.getElementById('mode-selector').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            // Initialize game engine
            const container = document.getElementById('canvas-container');
            
            window.gameEngine = new GameEngine({
                container,
                platformServices: {},
                config: { mode }
            });
            
            // Initialize enhanced features
            window.enhancedGame = new EnhancedGameIntegration(window.gameEngine);
            await window.enhancedGame.initialize();
            
            // Initialize 3D field
            window.field3D = new Baseball3DField(container);
            await window.field3D.init();
            
            // Start game engine
            await window.gameEngine.start();
            
            // Update display
            updateGameDisplay();
        };
        
        // Update game display
        function updateGameDisplay() {
            const stats = window.enhancedGame?.getGameStats();
            if (stats) {
                document.getElementById('inning-display').textContent = stats.summary.inning;
                document.getElementById('score-display').textContent = 
                    `HOME ${stats.summary.score.home} - ${stats.summary.score.away} AWAY`;
                document.getElementById('outs-display').textContent = stats.summary.outs;
            }
            
            requestAnimationFrame(updateGameDisplay);
        }
        
        // Camera view controls
        window.changeView = function(viewName) {
            if (window.field3D) {
                window.field3D.setCameraPosition(viewName);
                
                // Update active button
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }
        };
        
        // Toggle 2D/3D view
        window.toggle2D3D = function() {
            window.is3D = !window.is3D;
            // Implementation to switch between 2D canvas and 3D Three.js view
            console.log('Toggled to', window.is3D ? '3D' : '2D', 'view');
        };
        
        // Pitching controls
        window.pitch = function(pitchType) {
            if (window.enhancedGame) {
                const speeds = {
                    fastball: 95,
                    curveball: 78,
                    slider: 87,
                    changeup: 82
                };
                window.enhancedGame.simulatePitch(pitchType, speeds[pitchType]);
            }
        };
        
        // Batting controls
        window.swing = function(swingType) {
            if (window.enhancedGame) {
                const params = {
                    power: { batSpeed: 85, batAngle: 25 },
                    contact: { batSpeed: 70, batAngle: 5 },
                    bunt: { batSpeed: 30, batAngle: -5 }
                };
                window.enhancedGame.simulateSwing(params[swingType]);
            }
        };
        
        // Game management
        window.saveGame = function() {
            if (window.enhancedGame) {
                window.enhancedGame.saveGame();
                alert('Game saved!');
            }
        };
        
        window.loadGame = function() {
            if (window.enhancedGame) {
                if (window.enhancedGame.loadGame()) {
                    alert('Game loaded!');
                } else {
                    alert('No saved game found!');
                }
            }
        };
        
        window.showStats = function() {
            if (window.enhancedGame) {
                const stats = window.enhancedGame.getGameStats();
                console.log('Game Statistics:', stats);
                // TODO: Show stats in a modal
            }
        };
        
        window.pauseGame = function() {
            // TODO: Implement pause functionality
            console.log('Game paused');
        };
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    window.swing('contact');
                    break;
                case 'p':
                    window.pitch('fastball');
                    break;
                case '1':
                    window.changeView('broadcast');
                    break;
                case '2':
                    window.changeView('pitcher');
                    break;
                case '3':
                    window.changeView('batter');
                    break;
                case '4':
                    window.changeView('overhead');
                    break;
            }
        });
        
        // Start loading when page loads
        simulateLoading();
    </script>
</body>
</html>